---
title: "オペレーティング システムをアップグレードするタスク シーケンスの作成"
titleSuffix: Configuration Manager
description: "System Center Configuration Manager のタスク シーケンスで、オペレーティング システムを Windows 7 以降から Windows 10 に自動的にアップグレードできます。"
ms.custom: na
ms.date: 12/05/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 7591e386-a9ab-4640-8643-332dce5aa006
caps.latest.revision: "12"
author: aczechowski
ms.author: aaroncz
manager: angrobe
ms.openlocfilehash: 058b0710484a0452ddf19655bf2cabbb43f624ad
ms.sourcegitcommit: 92c3f916e6bbd35b6208463ff406e0247664543a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/02/2018
---
# <a name="create-a-task-sequence-to-upgrade-an-operating-system-in-system-center-configuration-manager"></a>System Center Configuration Manager のオペレーティング システムをアップグレードするタスク シーケンスを作成する

*適用対象: System Center Configuration Manager (Current Branch)*

Configuration Manager でタスク シーケンスを使用して、オペレーティング システムをインストール先のコンピューターで自動的にアップグレードします。 Windows 7 以降から Windows 10 に、または Windows Server 2012 以降から Windows Server 2016 にアップグレードできます。 アプリケーションまたはソフトウェア更新プログラムなど、オペレーティング システムのアップグレード パッケージやインストールする他のコンテンツを参照するタスク シーケンスを作成します。 オペレーティング システムをアップグレードするタスク シーケンスは、「[Windows を最新バージョンにアップグレードする](upgrade-windows-to-the-latest-version.md)」シナリオの一部です。  

##  <a name="BKMK_UpgradeOS"></a> オペレーティング システムをアップグレードするタスク シーケンスの作成  
 コンピューター上のオペレーティング システムをアップグレードするには、タスク シーケンスを作成し、タスク シーケンスの作成ウィザードで **[オペレーティング システムをアップグレード パッケージからアップグレードする]** を選択します。 ウィザードにより、オペレーティング システムのアップグレード、ソフトウェア更新プログラムの適用、アプリケーションのインストールの各ステップが追加されます。 タスク シーケンスを作成する前に、以下の要件を満たす必要があります。    

-   **必須**  

     - [オペレーティング システムのアップグレード パッケージ](../get-started/manage-operating-system-upgrade-packages.md) が Configuration Manager コンソールで使用可能である必要があります。
     - Windows Server 2016 にアップグレードする場合は、オペレーティング システムのアップグレードのタスク シーケンス ステップで、**[Ignore any dismissable compatibility messages]\(互換性に関する却下可能なメッセージをすべて無視する\)** 設定を選択します。 そうしないと、アップグレードは失敗します。

-   **必須 (使用する場合)**  

    -   [ソフトウェア更新プログラム](../../sum/get-started/synchronize-software-updates.md)が Configuration Manager コンソールで同期されている必要があります。  

    -   [アプリケーション](../../apps/deploy-use/create-applications.md)が Configuration Manager コンソールに追加されている必要があります。  

#### <a name="to-create-a-task-sequence-that-upgrades-an-operating-system"></a>オペレーティング システムをアップグレードするタスク シーケンスを作成するには  

1.  Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。  

2.  **[ソフトウェア ライブラリ]** ワークスペースで **[オペレーティング システム]** を展開して、**[タスク シーケンス]** をクリックします。  

3.  **[ホーム]** タブの **[作成]** グループで **[タスク シーケンスの作成]** をクリックして、タスク シーケンスの作成ウィザードを起動します。  

4.  **[新しいタスク シーケンスの作成]** ページで、 **[オペレーティング システムをアップグレード パッケージからアップグレードする]**をクリックしてから、 **[次へ]**をクリックします。  

5.  **[タスク シーケンス情報]** ページで次の設定を指定し、**[次へ]** をクリックします。  

    -   **タスク シーケンス名**:タスク シーケンスを識別する名前を指定します。  

    -   **説明**: タスク シーケンスによって実行されるタスクの説明を指定します。  

6.  **[Windows オペレーティング システムのアップグレード]** ページで次の設定を指定し、 **[次へ]**をクリックします。  

    -   **[アップグレード パッケージ]**: オペレーティング システムのアップグレードのソース ファイルを含むアップグレード パッケージを指定します。 **[プロパティ]** ウィンドウの情報を参照して、正しいアップグレード パッケージが選択されていることを確認できます。 詳細については、「[オペレーティング システムのアップグレード パッケージの管理](../get-started/manage-operating-system-upgrade-packages.md)」を参照してください。  

    -   **[エディション インデックス]**: 複数のオペレーティング システムのエディション インデックスをパッケージから入手できる場合、希望のエディション インデックスを選択します。 既定では、最初の項目が選択されています。  

    -   **プロダクト キー**: インストールする Windows オペレーティング システムのプロダクト キーを指定します。 エンコードされたボリューム ライセンス キーと標準のプロダクト キーを指定できます。 エンコードされていないプロダクト キーを使用する場合は、5 文字の各グループをダッシュ (-) で区切る必要があります。 例: *XXXXX-XXXXX-XXXXX-XXXXX-XXXXX* ボリューム ライセンス版のアップグレードの場合は、プロダクト キーは必要ありません。 製品版の Windows のアップグレードの場合のみ、プロダクト キーが必要です。  

    -   **[Ignore any dismissable compatibility messages]\(互換性に関する却下可能なメッセージをすべて無視する\)**: Windows Server 2016 にアップグレードする場合は、この設定を選択します。 この設定を選択しないと、Windows アプリの互換性ダイアログで、ユーザーが **[確認]** をクリックするのを Windows セットアップが待機してしまうため、タスク シーケンスを完了できません。   

7.  **[更新プログラムを含める]** ページで、必要なソフトウェア更新プログラム、すべてのソフトウェア更新プログラム、またはソフトウェア更新プログラムなしを指定してから、**[次へ]**をクリックします。 ソフトウェア更新プログラムをインストールするように指定する場合、Configuration Manager は、セットアップ先のコンピューターがメンバーとなっているコレクション向けのソフトウェア更新プログラムのみをインストールします。  

8.  **[アプリケーションのインストール]** ページで、展開先コンピューターにインストールするアプリケーションを指定してから、**[次へ]**をクリックします。 複数のアプリケーションを指定する場合は、特定のアプリケーションのインストールに失敗したときにタスク シーケンスを続行するかどうかも指定することができます。  

9. ウィザードを完了します。  



## <a name="configure-pre-cache-content"></a>コンテンツの事前キャッシュを構成する
バージョン 1702 以降では、タスク シーケンスの利用可能な展開について、事前キャッシュ機能を使用することで、ユーザーがタスク シーケンスをインストールする前に関連するコンテンツのみをクライアントにダウンロードさせることができます。
> [!TIP]  
> この機能はバージョン 1702 で[プレリリース機能](/sccm/core/servers/manage/pre-release-features)として初めて導入されました。 1706 以降のバージョンでは、この機能はプレリリース機能ではありません。

たとえば、Windows 10 のインプレース アップグレード タスク シーケンスを展開する場合で、すべてのユーザーに対して必要なタスク シーケンスは 1 つのみで、複数のアーキテクチャおよび/または言語に対応する必要があるとします。 以前のバージョンでは、ユーザーがソフトウェア センターから利用可能なタスク シーケンスの展開をインストールするときに、コンテンツのダウンロードが開始されます。 この遅延のため、インストールできる状態になるまでさらに時間がかかります。 また、タスク シーケンスで参照されているすべてのコンテンツがダウンロードされます。 このコンテンツには、すべての言語とアーキテクチャ用のオペレーティング システム アップグレード パッケージが含まれます。 各アップグレード パッケージのサイズが約 3 GB の場合、コンテンツ全体が非常に大きくなります。

コンテンツの事前キャッシュ機能には、クライアントが展開を受信してすぐに適用可能なコンテンツのみをダウンロードできるようにするオプションが用意されています。 したがって、ユーザーがソフトウェア センターで **[インストール]** をクリックすると、コンテンツはローカルのハード ドライブ上にあるため、コンテンツは準備完了の状態にあり、インストールが迅速に開始されます。

### <a name="to-configure-the-pre-cache-feature"></a>事前キャッシュ機能を構成するには

1. 特定のアーキテクチャおよび言語に対応したオペレーティング システム アップグレード パッケージを作成します。 パッケージの **[データ ソース]** タブでアーキテクチャと言語を指定します。 言語については、10 進数変換を使用します (たとえば、1033 は英語を表す 10 進数です。これを 16 進数で表すと 0x0409 となります)。 詳細については、「[オペレーティング システムをアップグレードするタスク シーケンスの作成](/sccm/osd/deploy-use/create-a-task-sequence-to-upgrade-an-operating-system)」を参照してください。

    アーキテクチャと言語の値は、オペレーティング システム アップグレード パッケージが事前にキャッシュされるかどうかを判断するためのタスク シーケンスの手順の条件と一致します。
1. さまざまな言語およびアーキテクチャに対して条件付きステップを適用するタスク シーケンスを作成します。 たとえば、次の手順では英語版が使用されます。

    ![事前キャッシュのプロパティ](../media/precacheproperties2.png)

    ![事前キャッシュのオプション](../media/precacheoptions2.png)  

3. タスク シーケンスを展開します。 事前キャッシュの機能については、次の設定を構成します。
    - **[全般]** タブで、**[このタスク シーケンス用のコンテンツを事前にダウンロードする]** を選択します。
    - **[展開設定]** タブで、**[目的]** を **[利用可能]** にしてタスク シーケンスを構成します。
    - **[スケジュール]** タブの **[この展開が使用可能になる日時を指定する]** 設定については、現在選択されている時間を選択します。 クライアントは、展開の利用可能な時間にコンテンツの事前キャッシュを開始します。 対象となるクライアントがこのポリシーを受け取ると、利用可能な時間が過去の時間となるため、すぐにダウンロードの事前キャッシュが開始されます。 クライアントがこのポリシーを受け取っても、利用可能な時間が未来の時間である場合、クライアントは利用可能な時間になるまでコンテンツの事前キャッシュを開始しません。 
    - **[配布ポイント]** タブで、**[展開オプション]** 設定を構成します。 ユーザーがインストールを開始する前にコンテンツを事前キャッシュしない場合は、これらの設定を使用します。


### <a name="user-experience"></a>ユーザー側の表示と操作
- クライアントは、展開ポリシーを受け取ると、展開の利用可能な時間後にコンテンツの事前キャッシュを開始します。 このコンテンツには、参照されるすべてのコンテンツと、オペレーティング システム アップグレード パッケージのうち、タスク シーケンスで設定した条件に基づいてクライアントと一致したものが含まれます。
- ユーザーが展開を利用できるようになったときに、ユーザーに新しい展開について知らせる通知が表示され、タスク シーケンスがソフトウェア センターに表示されます。 ユーザーはソフトウェア センターに移動し、**[インストール]** をクリックしてインストールを開始します。
- ユーザーがタスク シーケンスをインストールしたときにコンテンツが完全に事前キャッシュされない場合、クライアントは、展開の **[展開オプション]** タブで指定された設定を使用します。 



## <a name="download-package-content-task-sequence-step"></a>パッケージ コンテンツのダウンロードのタスク シーケンスのステップ  
 以下のシナリオでは、**オペレーティング システムのアップグレード**のステップの前に、[パッケージ コンテンツのダウンロード](../understand/task-sequence-steps.md#BKMK_DownloadPackageContent)のステップを使用できます。  

-   X86 と x64 の両方のプラットフォームで 1 つのアップグレード タスク シーケンスを使用します。 **[アップグレードの準備]** グループで 2 つの **[パッケージ コンテンツのダウンロード]** ステップを含めます。 クライアント アーキテクチャを検出するために各ステップで条件を設定します。 この条件により、ステップでは適切なオペレーティング システム アップグレード パッケージのみがダウンロードされるようになります。 同じ変数を使用するようにそれぞれの **[パッケージ コンテンツのダウンロード]** ステップを構成して、 **[オペレーティング システムのアップグレード]** ステップ上のメディア パスにその変数を使用します。  

-   該当するドライバー パッケージを動的にダウンロードするには、ドライバー パッケージごとに適切なハードウェアの種類を検出する条件を含む 2 つの **[パッケージ コンテンツのダウンロード]** ステップを使用します。 同じ変数を使用するように **[パッケージ コンテンツのダウンロード]** ステップをそれぞれ構成します。 その後、**[オペレーティング システムのアップグレード]** ステップのドライバー セクションの **[ステージング済みコンテンツ]** 値でその変数を使用します。  

   > [!NOTE]
   > 複数のパッケージがある場合は、Configuration Manager によって、数字のサフィックスが変数名に追加されます。 たとえば、カスタム変数として変数 %mycontent% を指定した場合、この場所はクライアントが参照されているすべてのコンテンツを格納する場所となります。 **[オペレーティング システムのアップグレード]** などのサブシーケンス ステップで変数を参照するときに、数字のサフィックスと共にこの変数を使用します。 この例では、%mycontent01% または %mycontent02% のようになります。この数字は、**[パッケージ コンテンツのダウンロード]** ステップでこの特定のコンテンツがリストされる順序に対応しています。

## <a name="optional-post-processing-task-sequence-steps"></a>オプションの後処理のタスク シーケンスのステップ  
 タスク シーケンスの作成後に、必要に応じてステップを追加します。 たとえば、既知の互換性の問題があるアプリケーションをアンインストールする場合や、コンピューターが再起動して Windows 10 へのアップグレードが成功した後に実行する後処理操作を追加する場合です。 これらの追加ステップを、後処理のタスク シーケンスのグループに追加します。  

> [!NOTE]  
>  このタスク シーケンスは線形ではないため、クライアント コンピューターを正常にアップグレードできるかどうかや、クライアント コンピューターを起動時のオペレーティング システムのバージョンにロールバックする必要があるかどうかに応じて、ステップには条件が課され、それらはタスク シーケンスの結果に影響を与える可能性があります。  

## <a name="optional-rollback-task-sequence-steps"></a>オプションのロールバックのタスク シーケンスのステップ  
 コンピューターの再起動後にアップグレード プロセスで問題が生じると、Windows セットアップはアップグレードを前のオペレーティング システムにロールバックします。 その後、タスク シーケンスはロールバック グループのすべてのステップを続行します。 タスク シーケンスの作成後、ロールバック グループにオプションのステップを追加することができます。  

## <a name="folder-and-files-removed-after-computer-restart"></a>コンピューターの再起動後に削除されるフォルダーとファイル  
 タスク シーケンスの完了時に、クライアントは、コンピューターが再起動されるまで後処理およびロールバック スクリプトを削除しません。 これらのスクリプト ファイルには、機密情報は含めないでください。  
