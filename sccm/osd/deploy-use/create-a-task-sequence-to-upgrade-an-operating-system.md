---
title: OS の更新タスク シーケンスを作成する
titleSuffix: Configuration Manager
description: タスク シーケンスを使用して、自動的に Windows 7 以降から Windows 10 にアップグレードします。
ms.date: 07/30/2018
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 7591e386-a9ab-4640-8643-332dce5aa006
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 483b5f8b285fb256005e31e01a0786cef6c8e11d
ms.sourcegitcommit: 1826664216c61691292ea2a79e836b11e1e8a118
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2018
ms.locfileid: "39383087"
---
# <a name="create-a-task-sequence-to-upgrade-an-os-in-configuration-manager"></a>Configuration Manager で OS をアップグレードするタスク シーケンスを作成する

*適用対象: System Center Configuration Manager (Current Branch)*

Configuration Manager でタスク シーケンスを使用して、OS をインストール先のコンピューターで自動的にアップグレードします。 Windows 7 以降から Windows 10 に、または Windows Server 2012 以降から Windows Server 2016 にアップグレードできます。 アプリケーションまたはソフトウェア更新プログラムなど、OS のアップグレード パッケージやインストールする他のコンテンツを参照するタスク シーケンスを作成します。 OS をアップグレードするタスク シーケンスは、「[Windows を最新バージョンにアップグレードする](upgrade-windows-to-the-latest-version.md)」シナリオの一部です。  



## <a name="prerequisites"></a>[前提条件]

タスク シーケンスを作成する前に、以下の要件を満たす必要があります。    

#### <a name="required"></a>必須  

- [OS のアップグレード パッケージ](/sccm/osd/get-started/manage-operating-system-upgrade-packages)が Configuration Manager コンソールで使用可能である必要があります。  

- Windows Server 2016 にアップグレードする場合は、オペレーティング システムのアップグレードのタスク シーケンス ステップで、**[Ignore any dismissable compatibility messages]\(互換性に関する却下可能なメッセージをすべて無視する\)** 設定を選択します。 そうしないと、アップグレードは失敗します。  

#### <a name="required-if-used"></a>必須 (使用する場合)  

-   [ソフトウェア更新プログラム](/sccm/sum/get-started/synchronize-software-updates)が Configuration Manager コンソールで同期されている必要があります。  

-   [アプリケーション](/sccm/apps/deploy-use/create-applications)が Configuration Manager コンソールに追加されている必要があります。  



##  <a name="BKMK_UpgradeOS"></a> OS をアップグレードするタスク シーケンスを作成する  

クライアント上の OS をアップグレードするには、タスク シーケンスを作成し、タスク シーケンスの作成ウィザードで **[オペレーティング システムをアップグレード パッケージからアップグレードする]** を選択します。 ウィザードにより、OS のアップグレード、ソフトウェア更新プログラムの適用、アプリケーションのインストールのタスク シーケンス ステップが追加されます。 

#### <a name="to-create-a-task-sequence-that-upgrades-an-os"></a>OS をアップグレードするタスク シーケンスを作成するには  

1.  Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** ワークスペースに移動し、**[オペレーティング システム]** を展開して **[タスク シーケンス]** をクリックします。  

2.  リボンの **[ホーム]** タブにある **[作成]** グループで、**[タスク シーケンスの作成]** をクリックします。  

3.  タスク シーケンスの作成ウィザードの **[新しいタスク シーケンスの作成]** ページで、**[オペレーティング システムをアップグレード パッケージからアップグレードする]** を選択してから、**[次へ]** をクリックします。  

4.  **[タスク シーケンス情報]** ページで次の設定を指定し、**[次へ]** をクリックします。  

    -   **タスク シーケンス名**:タスク シーケンスを識別する名前を指定します。  

    -   **[説明]**: 必要に応じて、説明を指定します。  

5.  **[Windows オペレーティング システムのアップグレード]** ページで次の設定を指定し、**[次へ]** をクリックします。  

    -   **[アップグレード パッケージ]**: OS のアップグレードのソース ファイルを含むアップグレード パッケージを指定します。 **[プロパティ]** ウィンドウの情報を参照して、正しいアップグレード パッケージが選択されていることを確認します。 詳しくは、[OS のアップグレード パッケージの管理](/sccm/osd/get-started/manage-operating-system-upgrade-packages)に関するページをご覧ください。  

    -   **[エディション インデックス]**: 複数の OS のエディション インデックスをパッケージから入手できる場合、希望のエディション インデックスを選択します。 既定では、最初のインデックスが選択されます。  

    -   **[プロダクト キー]**:インストールする OS の Windows プロダクト キーを指定します。 エンコードされたボリューム ライセンス キーまたは標準のプロダクト キーを指定します。 標準のプロダクト キーを使う場合は、5 つの各文字グループをダッシュ (-) で区切ります。 例: *XXXXX-XXXXX-XXXXX-XXXXX-XXXXX* ボリューム ライセンス版のアップグレードの場合、プロダクト キーは必要ないことがあります。  

        > [!Note]  
        > このプロダクト キーは、マルチ ライセンス認証キー (MAK) または汎用ボリューム ライセンス キー (GVLK) でもかまいません。 GVLK は、キー管理サービス (KMS) クライアント セットアップ キーとも呼ばれます。 詳細については、「[ボリューム ライセンス認証の計画](https://docs.microsoft.com/windows/deployment/volume-activation/plan-for-volume-activation-client)」を参照してください。 KMS クライアント セットアップ キーの一覧については、Windows Server のライセンス認証ガイドの「[付録 A](https://docs.microsoft.com/windows-server/get-started/kmsclientkeys)」を参照してください。 

    -   **[互換性に関するメッセージが無視できる場合、すべて無視する]**: Windows Server 2016 にアップグレードする場合は、この設定を選択します。 この設定を選択しないと、Windows アプリの互換性ダイアログで、ユーザーが **[確認]** をクリックするのを Windows セットアップが待機してしまうため、タスク シーケンスを完了できません。   

7.  **[更新プログラムを含める]** ページで、必要なソフトウェア更新プログラムまたはすべてのソフトウェア更新プログラムをインストールするか、まったくインストールしないかを指定します。 **[次へ]** をクリックします。 ソフトウェア更新プログラムをインストールするように指定する場合、Configuration Manager は、セットアップ先のコンピューターがメンバーとなっているコレクション向けの更新プログラムのみをインストールします。  

8.  **[アプリケーションのインストール]** ページで、展開先コンピューターにインストールするアプリケーションを指定してから、**[次へ]** をクリックします。 複数のアプリケーションを選択する場合は、特定のアプリケーションのインストールが失敗したときにタスク シーケンスを続行するかどうかも指定します。  

9. ウィザードを完了します。  


> [!Important]  
> タスク シーケンスがデバイス上で実行すると、構成マネージャー クライアントはさまざまなシナリオでタスク シーケンスの動作を制御するいくつかのスクリプトを作成します。 タスク シーケンスが完了しても、クライアントはコンピューターが再起動するまでこれらのスクリプトを削除しません。 これらのスクリプト ファイルには、機密情報は含まれません。  


バージョン 1802 以降、Windows 10 の一括アップグレード用の既定のタスク シーケンス テンプレートに、アップグレード プロセスの前後に追加する推奨アクションを含む追加グループが含まれます。 これらのアクションは、Windows 10 にデバイスを正常にアップグレードしている多くのユーザーに共通するものです。 詳細については、[アップグレードの準備](#recommended-task-sequence-steps-to-prepare-for-upgrade)および[処理後](#recommended-task-sequence-steps-for-post-processing)の推奨されるタスク シーケンス ステップを参照してください。

バージョン 1806 以降では、このタスク シーケンス テンプレートには、アップグレード プロセスが失敗した場合に追加する推奨アクションを備えたグループも含まれます。 これらのアクションによって、トラブルシューティングが容易になりました。 詳しくは、「[失敗時の推奨されるタスク シーケンス ステップ](#recommended-task-sequence-steps-on-failure)」をご覧ください。<!--1358500-->  



## <a name="configure-pre-cache-content"></a>コンテンツの事前キャッシュを構成する
<!--1021244-->タスク シーケンスの利用可能な展開について、事前キャッシュ機能を使用することで、ユーザーがタスク シーケンスをインストールする前に、関連する OS アップグレード パッケージ コンテンツをクライアントにダウンロードさせることができます。  

> [!Note]  
> Configuration Manager では、このオプション機能は既定で無効です。 この機能は、使用する前に有効にする必要があります。 詳細については、「[更新プログラムのオプション機能の有効化](/sccm/core/servers/manage/install-in-console-updates#bkmk_options)」を参照してください。<!--505213-->  


たとえば、すべてのユーザーに対して、1 つのインプレース アップグレード タスク シーケンスのみを作成して、多くのアーキテクチャと言語を使用できます。 以前のバージョンでは、ユーザーがソフトウェア センターから利用可能なタスク シーケンスの展開をインストールするときに、コンテンツのダウンロードが開始されます。 この遅延のため、インストールできる状態になるまでさらに時間がかかります。 タスク シーケンスで参照されているすべてのコンテンツがダウンロードされます。 このコンテンツには、すべての言語とアーキテクチャ用の OS アップグレード パッケージが含まれます。 各アップグレード パッケージのサイズが約 3 GB の場合、コンテンツ全体が非常に大きくなります。

事前キャッシュ コンテンツにより、クライアントでは展開を受け取ったらすぐに適用可能な OS アップグレード パッケージと他のすべての参照コンテンツだけをダウンロードすることができます。 ユーザーがソフトウェア センターで **[インストール]** をクリックすると、コンテンツの準備が完了します。 コンテンツがローカルのハード ドライブ上にあるため、インストールはすぐに開始します。

> [!NOTE]  
> 現在この動作は、OS アップグレード パッケージにのみ適用されます。 そのパッケージは、対応するアーキテクチャまたは言語を指定する唯一のコンテンツです。 たとえば、タスク シーケンスが複数のドライバー パッケージも参照する場合、クライアントは現在、それらをすべてダウンロードします。 タスク シーケンス エンジンは、事前にではなく、タスク シーケンスを実行する際に条件を評価します。 クライアントは、パッケージのプロパティのタグを使って、事前にキャッシュに入れる対象のコンテンツを判断します。


### <a name="to-configure-the-pre-cache-feature"></a>事前キャッシュ機能を構成するには

1. 特定のアーキテクチャおよび言語に対応した OS アップグレード パッケージを作成します。 パッケージの **[データ ソース]** タブでアーキテクチャと言語を指定します。 言語については、10 進変換を使用します。 たとえば、**1033** は英語を表す 10 進数値です。これを 16 進数で表すと **0x0409** となります。  

    クライアントは、アーキテクチャと言語の値を評価し、事前キャッシュ中にダウンロードする OS アップグレード パッケージを決定します。  

2. さまざまな言語およびアーキテクチャに対して条件付きステップを適用するタスク シーケンスを作成します。 たとえば、次の手順では英語版が使用されます。  

    ![ENU、DEU、JPN の複数の OS アップグレード ステップを示すタスク シーケンス エディター](../media/precacheproperties2.png)

    ![ロケールおよび OSArchitecture の WMI WQL クエリを表示しているタスク シーケンス エディターの [オプション] タブ](../media/precacheoptions2.png)  

3. タスク シーケンスを展開します。 事前キャッシュの機能については、次の設定を構成します。  

    - **[全般]** タブで、**[このタスク シーケンス用のコンテンツを事前にダウンロードする]** を選択します。  

    - **[デプロイ設定]** タブで、タスク シーケンスを **[利用可能]** として構成します。  

    - **[スケジュール]** タブで、設定 **[この展開が使用可能になる日時を指定する]** について現在選択されている時間を選択します。 クライアントは、展開の利用可能な時間にコンテンツの事前キャッシュを開始します。 対象となるクライアントがこのポリシーを受け取ると、利用可能な時間が過去の時間となるため、すぐにダウンロードの事前キャッシュが開始されます。 クライアントがこのポリシーを受け取っても、利用可能な時間が未来の時間である場合、クライアントは利用可能な時間になるまでコンテンツの事前キャッシュを開始しません。  

    - **[配布ポイント]** タブで、**[展開オプション]** 設定を構成します。 ユーザーがインストールを開始する前にコンテンツを事前キャッシュしない場合は、クライアントはこれらの設定を使用します。  
  

### <a name="user-experience"></a>ユーザー側の表示と操作

- クライアントが、展開ポリシーを受け取ると、展開の利用可能な時間後にコンテンツの事前キャッシュを開始します。 このコンテンツには、すべての参照先のパッケージが含まれていますが、パッケージのアーキテクチャと言語の属性と一致する OS アップグレード パッケージのみです。  

- クライアントでユーザーが展開を利用できるようになったときに、ユーザーに新しい展開について知らせる通知が表示されます。 これで、タスク シーケンスはソフトウェア センターで表示されます。 ユーザーはソフトウェア センターに移動し、**[インストール]** をクリックしてインストールを開始します。  

- ユーザーがタスク シーケンスをインストールするときにコンテンツが完全に事前キャッシュされなかった場合、クライアントは、展開の **[デプロイ オプション]** タブで指定された設定を使用します。  



## <a name="recommended-task-sequence-steps-to-prepare-for-upgrade"></a>アップグレードを準備する推奨されるタスク シーケンスのステップ

バージョン 1802 以降、Windows 10 の一括アップグレード用の既定のタスク シーケンス テンプレートに、アップグレード プロセスの前に追加する推奨アクションを含む追加グループが含まれます。 **[アップグレードの準備]** グループのこれらのアクションは、Windows 10 にデバイスを正常にアップグレードしている多くのユーザーに共通するものです。 1802 より前のバージョンのサイトでは、**[アップグレードの準備]** グループでタスク シーケンスに手動でこれらのアクションを追加します。  

- **[バッテリのチェック]**: コンピューターがバッテリを使っているか、または有線の電源を使っているかを確認するには、このグループにステップを追加します。 このアクションには、このチェックを実行するためのカスタム スクリプトまたはユーティリティが必要です。  

- **[ネットワーク接続およびワイヤード接続のチェック]**: コンピューターがネットワークに接続されているか、またワイヤレス接続を使っていないかどうかを確認するには、このグループにステップを追加します。 このアクションには、このチェックを実行するためのカスタム スクリプトまたはユーティリティが必要です。  

- **[互換性のないアプリケーションを削除する]**: このバージョンの Windows 10 と互換性がないすべてのアプリケーションを削除するには、このグループにステップを追加します。 アプリケーションをアンインストールする方法はさまざまです。  

    - アプリケーションが Windows インストーラーを使っている場合は、アプリケーションの Windows インストーラー展開の種類プロパティの **[プログラム]** タブから、**[アンインストール プログラム]** コマンド ラインをコピーします。 そして、アンインストール プログラムのコマンド ラインの **[コマンド ラインの実行]** ステップを、このグループに追加します。 次に例を示します。 </br>`msiexec /x {150031D8-1234-4BA8-9F52-D6E5190D1CBA} /q`</br>  

- **[互換性のないドライバーを削除する]**: このバージョンの Windows 10 と互換性がないすべてのドライバーを削除するには、このグループにステップを追加します。  

- **[サード パーティ セキュリティの削除/停止]**: ウイルス対策ソフトウェアなど、サード パーティのセキュリティ プログラムを削除または中断するには、このグループにステップを追加します。  

   - サード パーティのディスク暗号化プログラムを使っている場合は、`/ReflectDrivers` [コマンド ライン オプション](https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options#23)で、Windows セットアップにその暗号化ドライバーを提供します。 [[タスク シーケンス変数の設定]](/sccm/osd/understand/task-sequence-steps#BKMK_SetTaskSequenceVariable) ステップを、このグループのタスク シーケンスに追加します。 タスク シーケンス変数を **OSDSetupAdditionalUpgradeOptions** に設定します。 値をドライバーへのパス `/ReflectDrivers` に設定します。 この[タスク シーケンス アクション変数](/sccm/osd/understand/task-sequence-action-variables#upgrade-operating-system)をタスク シーケンスで使われる Windows セットアップ コマンド ラインに追加します。 このプロセスの他のガイダンスについては、ソフトウェアの製造元にお問い合わせください。  


### <a name="download-package-content-task-sequence-step"></a>パッケージ コンテンツのダウンロードのタスク シーケンスのステップ  

以下のシナリオでは、**オペレーティング システムのアップグレード**のステップの前に、[パッケージ コンテンツのダウンロード](/sccm/osd/understand/task-sequence-steps#BKMK_DownloadPackageContent)のステップを使います。  

-   X86 と x64 の両方のプラットフォームで 1 つのアップグレード タスク シーケンスを使用します。 **[アップグレードの準備]** グループで 2 つの **[パッケージ コンテンツのダウンロード]** ステップを含めます。 クライアント アーキテクチャを検出するために各ステップで条件を設定します。 この条件により、ステップでは適切な OS アップグレード パッケージのみがダウンロードされるようになります。 同じ変数を使用するようにそれぞれの **[パッケージ コンテンツのダウンロード]** ステップを構成して、 **[オペレーティング システムのアップグレード]** ステップ上のメディア パスにその変数を使用します。  

-   該当するドライバー パッケージを動的にダウンロードするには、ドライバー パッケージごとに適切なハードウェアの種類を検出する条件を含む 2 つの **[パッケージ コンテンツのダウンロード]** ステップを使用します。 同じ変数を使用するように **[パッケージ コンテンツのダウンロード]** ステップをそれぞれ構成します。 その後、**[オペレーティング システムのアップグレード]** ステップのドライバー セクションの **[ステージング済みコンテンツ]** 値でその変数を使用します。  

    > [!NOTE]  
    > 複数のパッケージがある場合は、Configuration Manager によって、数字のサフィックスが変数名に追加されます。 たとえば、カスタム変数として `%mycontent%` を指定した場合、クライアントは参照されているすべてのコンテンツをこの場所に格納します。 **[オペレーティング システムのアップグレード]** などのサブシーケンス ステップで変数を参照するときに、数字のサフィックスと共にこの変数を使用します。 この例では、`%mycontent01%` または `%mycontent02%` のようになります。この数字は、**[パッケージ コンテンツのダウンロード]** ステップでこの特定のコンテンツがリストされる順序に対応しています。  



## <a name="recommended-task-sequence-steps-for-post-processing"></a>推奨される処理後のタスク シーケンス ステップ   

タスク シーケンスを作成した後で、これらの追加ステップを、**後処理**のタスク シーケンスのグループに追加します。  

> [!NOTE]  
>  このタスク シーケンスは直線的ではありません。 タスク シーケンスの結果に影響を与えるステップの条件があります。 この動作は、クライアント コンピューターを正常にアップグレードするかどうか、または元の OS にクライアント コンピューターをロールバックする必要があるかによって異なります。  

バージョン 1802 以降、Windows 10 の一括アップグレード用の既定のタスク シーケンス テンプレートに、アップグレード プロセスの後に追加する推奨アクションを含む追加グループが含まれます。 **[後処理]** グループのこれらのアクションは、Windows 10 にデバイスを正常にアップグレードしている多くのユーザーに共通するものです。 1802 より前のバージョンのサイトでは、**[後処理]** グループでタスク シーケンスに手動でこれらのアクションを追加します。  

- **[セットアップ ベースのドライバーを適用する]**: パッケージからセットアップ ベースのドライバー (.exe) をインストールするには、このグループにステップを追加します。  

- **[サード パーティ セキュリティのインストール/有効化]**: ウイルス対策ソフトウェアなど、サードパーティ製のセキュリティ プログラムをインストールするか有効にするには、このグループにステップを追加します。  

- **[Windows の既定のアプリと関連付けを設定する]**: Windows の既定のアプリとファイルの関連付けを設定するには、このグループにステップを追加します。 最初に、必要なアプリの関連付けで参照コンピューターを準備します。 それから、次のコマンドを実行してエクスポートします。 </br>`dism /online /Export-DefaultAppAssociations:"%UserProfile%\Desktop\DefaultAppAssociations.xml"`</br>XML ファイルをパッケージに追加します。 [[コマンド ラインの実行]](/sccm/osd/understand/task-sequence-steps#BKMK_RunCommandLine) ステップをこのグループに追加します。 XML ファイルを含むパッケージを指定し、次のコマンド ラインを指定します。 </br>`dism /online /Import-DefaultAppAssociations:DefaultAppAssocations.xml`</br> 詳細については、「[Export or import default application associations](/windows-hardware/manufacture/desktop/export-or-import-default-application-associations)」(既定のアプリケーションの関連付けをエクスポートまたはインポートする) を参照してください。  

- **[Apply customizations and personalization]\(カスタマイズと個人用設定を適用する\)**: プログラム グループの整理など、[スタート] メニューのカスタマイズを適用するには、このグループにステップを追加します。 詳細については、「[Customize the Start screen](/windows-hardware/manufacture/desktop/customize-the-start-screen)」(スタート画面をカスタマイズする) を参照してください。  



## <a name="optional-task-sequence-steps-for-rollback"></a>オプションのロールバックのタスク シーケンスのステップ  

コンピューターの再起動後にアップグレード プロセスで問題が発生すると、Windows セットアップは前の OS にシステムをロールバックします。 その後、タスク シーケンスは**ロールバック** グループのすべてのステップを続行します。 タスク シーケンスの作成後に、必要に応じてこのグループにステップを追加します。 たとえば、互換性のないソフトウェアをアンインストールするなど、[アップグレードの準備] グループで、システムに加えられた変更を取り消します。



## <a name="recommended-task-sequence-steps-on-failure"></a>失敗時の推奨されるタスク シーケンス ステップ
<!--1358500-->

バージョン 1806 以降では、Windows 10 の一括アップグレード用の既定のタスク シーケンス テンプレートには、**失敗時にアクションを実行**するためのグループが含まれます。 このグループには、アップグレード プロセスが失敗した場合に追加することが推奨されるアクションが含まれます。 これらのアクションによって、トラブルシューティングが容易になりました。

- **ログの収集**: クライアントからログを収集するには、このグループに手順を追加します。  

    - 通常は、ログ ファイルをネットワーク共有にコピーします。 この接続を確立するには、[ネットワーク フォルダーへの接続](/sccm/osd/understand/task-sequence-steps#BKMK_ConnectToNetworkFolder)の手順を使用します。  

    - コピー操作を実行するには、「[コマンド ラインの実行](/sccm/osd/understand/task-sequence-steps#BKMK_RunCommandLine)」または「[PowerShell スクリプトの実行](/sccm/osd/understand/task-sequence-steps#BKMK_RunPowerShellScript)」の手順のどちらかに従って、カスタム スクリプトまたはユーティリティを使用します。  

    - 収集するファイルには、次のログ ファイルが含まれる可能性があります。  
         `%_SMSTSLogPath%\*.log`   
         `%SystemDrive%\$Windows.~BT\Sources\Panther\setupact.log`  

    - setupact.log および他の Windows Setup ログ ファイルの詳細については、[Windows 設定ログ ファイル](https://docs.microsoft.com/windows/deployment/upgrade/log-files)に関するページをご覧ください。  

    - 構成マネージャー クライアントのログ ファイルについて詳しくは、「[Configuration Manager クライアントのログ ファイル](/sccm/core/plan-design/hierarchy/log-files#BKMK_ClientLogs)」をご覧ください。  

    - _SMSTSLogPath および他の便利な変数について詳しくは、「[タスク シーケンス組み込み変数](/sccm/osd/understand/task-sequence-built-in-variables)」をご覧ください。  

- **診断ツールの実行**: 追加の診断ツールを実行するには、このグループで手順を追加します。 失敗後すぐにシステムから追加情報を収集するために、これらのツールを自動化します。  

    - このようなツールの 1 つが、Windows の [SetupDiag](https://docs.microsoft.com/windows/deployment/upgrade/setupdiag) です。 これは、Windows 10 がアップグレードに失敗した詳細な理由を取得する、スタンドアロンの診断ツールです。  

        - Configuration Manager で、ツールの[パッケージを作成](/sccm/apps/deploy-use/packages-and-programs#create-a-package-and-program)します。  

        - [コマンド ラインの実行](/sccm/osd/understand/task-sequence-steps#BKMK_RunCommandLine)手順を、タスク シーケンスのこのグループに追加します。 **[パッケージ]** オプションを使用して、ツールを参照します。 次の文字列は、**コマンド ライン**のサンプルです。  
             `SetupDiag.exe /Output:"%_SMSTSLogPath%\SetupDiagResults.log" /Mode:Online`  



## <a name="additional-recommendations"></a>その他の推奨事項

- Windows のドキュメント「[Windows 10 のアップグレード エラーの解決](https://docs.microsoft.com/windows/deployment/upgrade/resolve-windows-10-upgrade-errors)」を参照してください。 この記事には、アップグレード プロセスに関する詳細情報も含まれています。  

- 既定の **[準備の確認]** ステップで、**[最小空きディスク容量 (MB) を満たすことを確認する]** を有効にします。 値を、32 ビット OS のアップグレード パッケージの場合は **16384** (16 GB) 以上、64 ビットの場合は **20480** (20 GB) 以上に設定します。  

- **SMSTSDownloadRetryCount** [組み込みタスク シーケンス変数](/sccm/osd/understand/task-sequence-built-in-variables)を使って、ポリシーのダウンロードを再試行します。 現在の既定では、クライアントは 2 回再試行します。この変数は 2 に設定されます。 クライアントがイントラネット ネットワークに有線接続されていない場合は、再試行回数を増やすと、クライアントがポリシーを取得するのに役立ちます。 この変数を使っても、ポリシーをダウンロードできない場合の障害の遅延以外に、悪影響はありません。<!--501016--> また、**SMSTSDownloadRetryDelay** 変数を既定値の 15 秒から増やします。  

- インラインの互換性評価を実行します。  

   - **[アップグレードの準備]** グループの早い段階に、第 2 の **[オペレーティング システムのアップグレード]** ステップを追加します。 その名前を "*アップグレード評価*" にします。 同じアップグレード パッケージを指定し、**[アップグレードを開始せずに Windows セットアップの互換性スキャンを実行する]** オプションを有効にします。 [オプション] タブで **[エラー時に続行する]** を有効にします。  

   - この "*アップグレード評価*" ステップの直後に、**[コマンド ラインの実行]** ステップを追加します。 次のコマンド ラインを指定します。</br> `cmd /c exit %_SMSTSOSUpgradeActionReturnCode%`</br>**[オプション]** タブで、次の条件を追加します。 </br>`Task Sequence Variable _SMSTSOSUpgradeActionReturnCode not equals 3247440400` </br>このリターン コードは MOSETUP_E_COMPAT_SCANONLY (0xC1900210) に相当する 10 進数で、互換性スキャンが成功して問題がなかったことを示します。 "*アップグレード評価*" ステップが成功してこのコードを返した場合、タスク シーケンスはこのステップをスキップします。 評価ステップが他のリターン コードを返した場合、このステップは Windows セットアップ互換性スキャンからのリターン コードでタスク シーケンスを失敗させます。  

   - 詳細については、「[オペレーティング システムのアップグレード](/sccm/osd/understand/task-sequence-steps#BKMK_UpgradeOS)」を参照してください。  

- このタスク シーケンスの間にデバイスを BIOS から UEFI に変更する場合は、「[インプレース アップグレード時に BIOS から UEFI に変換する](/sccm/osd/deploy-use/task-sequence-steps-to-manage-bios-to-uefi-conversion#convert-from-bios-to-uefi-during-an-in-place-upgrade)」を参照してください。  

- BitLocker Disk Encryption を使っている場合、Windows セットアップはアップグレード中にそれを既定で自動的に一時停止します。 Windows 10 バージョン 1803 以降、Windows セットアップにはこの動作を制御するための `/BitLocker` コマンド ライン パラメーターが含まれます。 セキュリティ要件のためディスク暗号化を常にアクティブに維持する必要がある場合は、**アップグレードの準備**グループの **OSDSetupAdditionalUpgradeOptions** タスク シーケンス変数を使って `/BitLocker TryKeepActive` を含めます。 詳しくは、「[Windows Setup Command-line Options](https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options#33)」(Windows セットアップ コマンド ライン オプション) をご覧ください。<!--SCCMDocs issue #494-->  

- お客様によっては、Windows 10 に既定でプロビジョニングされるアプリを削除することがあります。 たとえば、Bing 天気アプリや Microsoft Solitaire Collection などです。 状況によっては、Windows 10 の更新後にこれらのアプリが戻る場合があります。 詳しくは、「[How to keep apps removed from Windows 10](https://docs.microsoft.com/windows/application-management/remove-provisioned-apps-during-update)」(Windows 10 から削除されたアプリを維持する方法) をご覧ください。 **アップグレードの準備**グループのタスク シーケンスに**コマンド ラインの実行**ステップを追加します。 次の例のようなコマンド ラインを指定します。</br> `cmd /c reg delete "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore\Deprovisioned\Microsoft.BingWeather_8wekyb3d8bbwe" /f` <!--SCCMDocs issue #526-->  
