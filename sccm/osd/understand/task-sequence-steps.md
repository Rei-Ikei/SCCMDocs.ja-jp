---
title: "タスク シーケンスのステップ"
titleSuffix: Configuration Manager
description: "Configuration Manager タスク シーケンスに追加できるタスク シーケンス ステップについて説明します。"
ms.custom: na
ms.date: 01/12/2018
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 7c888a6f-8e37-4be5-8edb-832b218f266d
caps.latest.revision: 
caps.handback.revision: 
author: aczechowski
ms.author: aaroncz
manager: angrobe
ms.openlocfilehash: 5320d7747f7e2c6164da8c1801e631b749935d6d
ms.sourcegitcommit: b13da5ad8ffd58e3b89fa6d7170e1dec3ff130a4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/01/2018
---
# <a name="task-sequence-steps-in-system-center-configuration-manager"></a>System Center Configuration Manager のタスク シーケンスのステップ

*適用対象: System Center Configuration Manager (Current Branch)*

次のタスク シーケンス ステップは、Configuration Manager のタスク シーケンスに追加できます。 タスク シーケンスの編集については、「 [Edit a task sequence](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_ModifyTaskSequence)」を参照してください。  

次の設定は、タスク シーケンスのすべてのステップに共通です。

**[プロパティ]** タブ:
 - **名前**: タスク シーケンス エディターでは、このステップを説明する短い名前を指定する必要があります。 新しいステップを追加するとき、タスク シーケンス エディターは既定で名前を Type に設定します。 **[名前]** の長さは 50 文字以下です。
 - **説明**: 必要に応じて、このステップについての詳細な情報を指定します。 **[説明]** の長さは 256 文字以下です。
この記事の残りの部分では、各タスク シーケンス ステップの **[プロパティ]** タブにある他の設定について説明します。

**[オプション]** タブ:  
-   **このステップを無効にする**: タスク シーケンスはコンピューターで実行するときにこのステップをスキップします。 タスク シーケンス エディターでは、このステップのアイコンはグレー表示になります。 
-   **エラー時に続行する**: ステップの実行中にエラーが発生した場合でも、タスク シーケンスは続行します。  
-   **条件の追加**: タスク シーケンスはこれらの条件付きステートメントを評価して、ステップを実行するかどうかを決定します。   
特定のタスク シーケンス ステップに関する以下のセクションでは、**[オプション]** タブで指定できる他の設定について説明します。



##  <a name="BKMK_ApplyDataImage"></a> データ イメージの適用   
 このステップでは、データ イメージを指定した挿入先パーティションにコピーします。  

 このステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 タスク シーケンス変数の詳細については、「[タスク シーケンス アクション変数](task-sequence-action-variables.md)」を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[データ イメージの適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **イメージ パッケージ**  
 **[参照]** をクリックして、このタスク シーケンスで使う**イメージ パッケージ**を指定します。 **[パッケージの選択]** ダイアログ ボックスでインストールするパッケージを選択します。 既存の各イメージ パッケージの関連プロパティ情報が **[パッケージの選択]** ダイアログ ボックスの下部に表示されます。 ドロップダウン リストを使用して、選択した **イメージ パッケージ** からインストールする **イメージ** を選択します。  

> [!NOTE]  
>  このタスク シーケンス アクションは、画像をデータ ファイルとして扱います。 このアクションでは、イメージをオペレーティング システムとして起動するための設定は何も行われません。  

 **保存先**  
 次のいずれかのオプションを構成します。

-   **次に利用可能なパーティション**: このタスク シーケンスの**オペレーティング システムの適用**アクションまたは**データ イメージの適用**アクションの対象にまだなっていない次のシーケンシャル パーティションを使います。  

-   **特定のディスクとパーティション**: **ディスク**番号 (0 から開始) と**パーティション**番号 (1 から開始) を選びます。  

-   **特定の論理ドライブ文字**: Windows PE によりパーティションに割り当てられた**ドライブ文字**を指定します。 このドライブ文字は、新しく展開されるオペレーティング システムが割り当てるドライブ文字と異なっていてもかまいません。  

-   **変数に格納されている論理ドライブ文字**: Windows PE によりパーティションに割り当てられたドライブ文字を含むタスク シーケンス変数を指定します。 この変数は通常、**[ディスクのフォーマットとパーティション作成]** タスク シーケンス アクションの **[パーティションのプロパティ]** ダイアログ ボックスの [詳細設定] セクションで設定されます。  

**イメージを適用する前にパーティションのすべてのコンテンツを削除する**  
 イメージをインストールする前に対象パーティションのすべてのファイルをタスク シーケンスで削除することを指定します。 パーティションのコンテンツを削除しないことにより、このステップを使用して、以前にターゲットにしたパーティションに追加コンテンツを適用できます。  



##  <a name="BKMK_ApplyDriverPackage"></a> ドライバー パッケージの適用  
 このステップでは、ドライバー パッケージ内のすべてのドライバーをダウンロードして、Windows オペレーティング システムにインストールします。

 **[ドライバー パッケージの適用]** タスク シーケンス ステップでは、ドライバー パッケージ内のすべてのデバイス ドライバーを Windows セットアップで使用できるようにします。 パッケージ内のドライバーを Windows で使用できるようにするには、**[オペレーティング システムの適用]** ステップと **[Windows と ConfigMgr のセットアップ]** ステップの間に、このステップを追加します。 通常、**[ドライバー パッケージの適用]** タスク シーケンス ステップは、順番上、**[ドライバーの自動適用]** タスク シーケンス ステップの後に置かれます。 **[ドライバー パッケージの適用]** タスク シーケンス ステップは、スタンドアロンのメディア展開シナリオでも便利です。  

 同様のデバイス ドライバーは 1 つのドライバー パッケージに配置し、適切な配布ポイントに配布するようにします。 配布後に、Configuration Manager クライアント コンピューターはドライバーをインストールできます。 たとえば、1 つの製造元からのすべてのドライバーをドライバー パッケージに格納します。 その後、関連付けられたコンピューターがアクセスできる配布ポイントにパッケージを配布します。

 **[ドライバー パッケージの適用]** ステップは、スタンドアロン メディアの場合に便利です。 このステップは、特定のドライバー セットをインストールする場合にも役立ちます。 たとえば、ネットワーク プリンターのようなプラグ アンド プレイ スキャンでは検出されないデバイスなどのドライバーの種類です。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Apply Driver Package Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_ApplyDriverPackage)」を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ドライバー]** を選んで、**[ドライバー パッケージの適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ドライバー パッケージ**  
 **[参照]** をクリックし **[パッケージの選択]** ダイアログ ボックスを開いて、必要なデバイス ドライバーを含むドライバー パッケージを指定します。 使用可能にする既存パッケージを指定してください。 関連パッケージ プロパティは、ダイアログ ボックスの下部に表示されます。  

 **Vista 以前のオペレーティング システムをセットアップする前にインストールする必要がある大容量記憶装置ドライバーをパッケージから選択する**  
 古いオペレーティング システムをインストールするために必要な大容量記憶装置ドライバーを指定します。  

 **ドライバー**  
 古いオペレーティング システムをセットアップする前にインストールする大容量記憶装置ドライバーのファイルを選びます。 ドロップダウン リストの項目は指定したパッケージから設定されます。  

 **モデル**  
 Windows Vista 以前のオペレーティング システムの展開に必要となる、起動に不可欠なデバイスを指定します。  

 **署名されていないドライバーの無人インストールが許可されているバージョンの Windows でドライバーの無人インストールを行う**  
 このオプションを指定すると、Windows はデジタル署名のないドライバーをインストールできます。  



##  <a name="BKMK_ApplyNetworkSettings"></a> ネットワーク設定の適用   
 このステップでは、対象のコンピューターのネットワークまたはワークグループの構成情報を指定します。 タスク シーケンスは、これらの値を適切な応答ファイルに格納します。 Windows セットアップは、**Windows と ConfigMgr のセットアップ** アクションの間にこの応答ファイルを使います。  

 このタスク シーケンスのステップは標準のオペレーティング システムまたは Windows PE で実行されます。 このアクションのタスク シーケンス変数の詳細については、「 [Apply Network Settings Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_ApplyNetworkSettings)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[設定]** を選んで、**[ネットワーク設定の適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ワークグループに参加**  
 対象コンピューターを指定したワークグループに参加させるには、このオプションを選択します。 **[ワークグループ]** 行にワークグループの名前を入力します。 この値は、**[ネットワーク設定のキャプチャ]** タスク シーケンス ステップでキャプチャされた値により上書きされます。  

 **ドメインに参加**  
 対象コンピューターを指定したドメインに参加させるには、このオプションを選択します。 ドメイン (たとえば *fabricam.com* ) を直接指定するか参照します。組織単位の LDAP (Lightweight Directory Access Protocol) パスを指定または参照します。 例: *LDAP//OU=computers, DC=Fabricam.com, C=com*  

 **アカウント**  
 コンピューターをドメインに参加させるには、**[設定]** をクリックして必要なアクセス許可を持つアカウントを指定します。 **[Windows ユーザー アカウント]** ダイアログ ボックスでは、"**ドメイン\ユーザー**" の形式を使ってユーザー名を入力できます。  

 **アダプター設定**  
 コンピューターの各ネットワーク アダプターのネットワーク構成を指定します。 **[新規]** をクリックして **[ネットワーク設定]** ダイアログ ボックスを開き、ネットワーク設定を指定します。 **[ネットワーク設定のキャプチャ]** ステップも使った場合、タスク シーケンスは前のステップでキャプチャした設定をネットワーク アダプターに適用します。 タスク シーケンスでは、このステップで指定した設定を適用しません。 タスク シーケンスが前のステップでネットワーク設定をキャプチャしなかった場合は、**[ネットワーク設定の適用]** ステップで指定した設定が適用されます。 タスク シーケンスは、Windows デバイスの列挙の順序でネットワーク アダプターにこれらの設定を適用します。  



##  <a name="BKMK_ApplyOperatingSystemImage"></a> オペレーティング システム イメージの適用  

> [!TIP]  
> Windows 10 バージョン 1709 以降では、メディアに複数のエディションが含まれます。 タスク シーケンスが OS アップグレード パッケージまたは OS イメージを使うように構成するときは、[サポートされているエディション](/sccm/core/plan-design/configs/support-for-windows-10#windows-10-as-a-client)を必ず選んでください。

 このステップでは、オペレーティング システムを対象コンピューターにインストールします。 このステップは、OS イメージまたは OS アップグレード パッケージを使うかどうかに応じてアクションを実行します。  

 OS イメージを使うと、**[オペレーティング システム イメージの適用]** ステップは次のアクションを実行します。  

1.  &#95;SMSTSUserStatePath 変数で指定されているフォルダー内のファイルを除く、対象ボリューム上のすべてのコンテンツを削除します。

2.  指定された .wim ファイルのコンテンツを、指定された挿入先パーティションに抽出します。  

3.  応答ファイルを準備します。  

    1.  展開するオペレーティング システム用に既定の Windows セットアップ応答ファイル (sysprep.inf または unattend.xml) を新しく作成します。  

    2.  ユーザーが提供する応答ファイルから値をマージします。  

4.  Windows ブート ローダーをアクティブなパーティションにコピーします。  

5.  新しくインストールしたオペレーティング システムを参照するよう boot.ini またはブート構成データベース (BCD) を設定します。  

 OS アップグレード パッケージを使うと、**[オペレーティング システム イメージの適用]** ステップは次のアクションを実行します。  

1.  &#95;SMSTSUserStatePath 変数で指定されているフォルダー内のファイルを除く、対象ボリューム上のすべてのコンテンツを削除します。  

2.  応答ファイルを準備します。  

    1.  Configuration Manager によって作成された標準値を使って、新しい応答ファイルを作成します。  

    2.  ユーザーが提供する応答ファイルから値をマージします。  

> [!NOTE]  
>  **[Windows と ConfigMgr のセットアップ]** ステップによって、Windows のインストールが開始されます。 

 **[オペレーティング システムの適用]** アクションが実行された後、OSDTargetSystemDrive 変数は、オペレーティング システム ファイルが含まれるパーティションのドライブ文字に設定されます。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Apply Operating System Image Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_ApplyOperatingSystem)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[オペレーティング システム イメージの適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **キャプチャしたイメージからオペレーティング システムを適用する**  
 以前にキャプチャされたオペレーティング システム イメージをインストールします。 **[参照]** をクリックして **[パッケージの選択]** ダイアログ ボックスを開き、インストールする既存のイメージ パッケージを選択します。 指定した**イメージ パッケージ**に複数のイメージが関連付けられている場合は、ドロップダウン リストを使って、この展開に使う、関連付けられているイメージを指定します。 イメージをクリックすることで、既存の各イメージの基本情報を表示できます。  

 **元のインストール ソースからオペレーティング システムを適用する**  
 元のインストール ソースを使用してオペレーティング システムをインストールします。 **[参照]** をクリックして、**[オペレーティング システム インストール パッケージの選択]** ダイアログ ボックスを開きます。 その後、使う既存の OS アップグレード パッケージを選びます。 イメージ ソースをクリックすることで、既存の各イメージ ソースの基本情報を表示できます。 ダイアログ ボックスの下部にある結果ウィンドウに、関連付けられているイメージのプロパティが表示されます。 指定したパッケージに複数のエディションが関連付けられている場合は、ドロップダウン リストを使用して、使用する、関連付けられている **エディション** を指定します。  

 **カスタム インストールに無人ファイルまたは sysprep 応答ファイルを使用する**  
 オペレーティング システムのバージョンおよびインストール方法によって異なる Windows セットアップ応答ファイル (**unattend.xml**、 **unattend.txt**、または **sysprep.inf**) を提供するには、このオプションを使用します。 指定するファイルには、Windows 応答ファイルがサポートする任意の標準の構成オプションを含めることができます。 たとえば、この構成オプションを使用して既定の Internet Explorer のホーム ページを指定できます。 応答ファイルを含むパッケージ、およびパッケージ内のファイルへの関連付けられたパスを指定します。  

> [!NOTE]  
>  ユーザーが指定する Windows セットアップ応答ファイルには、%*varname*% という形式の埋め込みタスク シーケンス変数を含めることができます。*varname* は変数の名前です。 **[Windows と ConfigMgr のセットアップ]** ステップは、文字列 %*varname*% を実際の変数値に置き換えます。 これらの埋め込みタスク シーケンス変数は、unattend.xml 応答ファイルの数値のみのフィールドでは使うことができません。  

 ユーザーが Windows セットアップ応答ファイルを指定しない場合、このタスク シーケンス アクションは自動的に応答ファイルを生成します。  

 **保存先**  
 次のいずれかのオプションを構成します。  

-   **次に利用可能なパーティション**: このタスク シーケンスの**オペレーティング システムの適用**アクションまたは**データ イメージの適用**アクションの対象にまだなっていない次のシーケンシャル パーティションを使います。 

-   **特定のディスクとパーティション**: **ディスク**番号 (0 から開始) と**パーティション**番号 (1 から開始) を選びます。  

-   **特定の論理ドライブ文字**: Windows PE によりパーティションに割り当てられた**ドライブ文字**を指定します。 このドライブ文字は、新しく展開されるオペレーティング システムが割り当てるドライブ文字と異なっていてもかまいません。  

-   **変数に格納されている論理ドライブ文字**: Windows PE によりパーティションに割り当てられたドライブ文字を含むタスク シーケンス変数を指定します。 この変数は通常、**[ディスクのフォーマットとパーティション作成]** タスク シーケンス アクションの **[パーティションのプロパティ]** ダイアログ ボックスの [詳細設定] セクションで設定されます。  

### <a name="options"></a>Options  
 このタスク シーケンス ステップの **[オプション]** タブでは、既定のオプションだけでなく、以下の追加設定を構成します。  

-   **配布ポイントからコンテンツに直接アクセスする**  
     配布ポイントからオペレーティング システム イメージに直接アクセスするようにタスク シーケンスを構成します。 たとえば、記憶域の容量が限られている組み込みデバイスにオペレーティング システムを展開するときに、このオプションを使います。 また、このオプションを選択する場合は、パッケージ プロパティの **[データ アクセス]** タブでパッケージ共有設定も構成します。  

    > [!NOTE]  
    >  この設定は、**ソフトウェアの展開ウィザード**の **[配布ポイント]** ページで構成される展開オプションを上書きします。 この上書きは、すべてのタスク シーケンス コンテンツではなく、このステップで指定されている OS イメージに対してのみ適用されます。  



##  <a name="BKMK_ApplyWindowsSettings"></a> Windows 設定の適用  
 このステップでは、対象コンピューターに対して Windows の設定を構成します。 タスク シーケンスは、これらの値を適切な応答ファイルに格納します。 Windows セットアップは、**Windows と ConfigMgr のセットアップ** アクションの間にこの応答ファイルを使います。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Apply Windows Settings Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_ApplyWindowsSettings)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[設定]** を選んで、**[Windows 設定の適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ユーザー名**  
 対象のコンピューターに関連付けられている登録済みのユーザー名を指定します。 この値は、**[Windows 設定のキャプチャ]** タスク シーケンス アクションでキャプチャされた値により上書きされます。  

 **組織名**  
 対象のコンピューターに関連付けられている登録済みの組織名を指定します。 この値は、**[Windows 設定のキャプチャ]** タスク シーケンス アクションでキャプチャされた値により上書きされます。  

 **プロダクト キー**  
 対象のコンピューターで Windows インストールに使用されるプロダクト キーを指定します。  

 **サーバー ライセンス**  
 サーバー ライセンス モードを指定します。 ライセンス モードとして **[同時使用ユーザー数]** か **[接続ユーザー数]** を選択します。 **[同時使用ユーザー数]** を選ぶ場合は、ライセンス契約ごとに許可される接続の最大数も指定します。 対象のコンピューターがサーバーではない場合や、ライセンス モードを指定しない場合は、**[指定しない]** を選択する必要があります。  

 **最大接続数**  
 ライセンス契約に規定されているこのコンピューターで有効な接続の最大数を指定します。  

 **ローカルの管理者パスワードをランダムに生成し、サポートされているすべてのプラットフォームのアカウントを無効にする (推奨)**  
 ローカルの管理者パスワードをランダムに生成される文字列に設定するには、このオプションを選びます。 また、このオプションを選ぶと、この機能をサポートするプラットフォームでのローカル管理者アカウントが無効になります。  

 **アカウントを有効にし、ローカル管理者パスワードを指定する**  
 指定したパスワードを使うローカル管理者アカウントを有効にするには、このオプションを選びます。 パスワードを **[パスワード]** 行に入力し、**[パスワードの確認入力]** 行にパスワードを確認入力します。  

 **タイム ゾーン**  
 対象のコンピューターに構成するタイム ゾーンを指定します。 この値は、**[Windows 設定のキャプチャ]** タスク シーケンス ステップでキャプチャされた値によって上書きされます。  



##  <a name="BKMK_AutoApplyDrivers"></a> ドライバーの自動適用  
 このステップでは、オペレーティング システムの展開の一部としてドライバーを照合してインストールします。  

 **[ドライバーの自動適用]** タスク シーケンス ステップでは次の手順を実行します。  

1.  ハードウェアをスキャンし、システム上に存在するすべてのデバイスのプラグ アンド プレイ ID を検索します。  

2.  デバイスとプラグ アンド プレイ ID の一覧を管理ポイントに送信します。 管理ポイントは、各ハードウェア デバイス用にドライバー カタログから互換ドライバーの一覧を返します。 一覧には、含まれるドライバー パッケージに関係なくすべてのドライバー、指定したドライバー カテゴリでタグ付けされたドライバー、無効になっていないドライバーが含まれます。  

3.  ハードウェア デバイスごとに、タスク シーケンスは最適なドライバーを選びます。 このドライバーは、展開されるオペレーティング システムに適しており、アクセス可能な配布ポイント上にあります。  

4.  タスク シーケンスは、選んだドライバーを配布ポイントからダウンロードし、対象のオペレーティング システムにドライバーをステージングします。  

    1.  イメージ ベースのインストールでは、タスク シーケンスはドライバーをオペレーティング システムのドライバー ストアに格納します。  

    2.  セットアップ ベースのインストールでは、タスク シーケンスはドライバーの場所で Windows セットアップを構成します。  

5.  タスク シーケンスでの **[Windows と ConfigMgr のセットアップ]** ステップの間に、Windows セットアップはこのアクションによってステージングされたドライバーを検索します。  

> [!IMPORTANT]
>  スタンドアロン メディアは、**[ドライバーの自動適用]** ステップを使うことができません。 このシナリオでは、Windows セットアップは Configuration Manager サイトに接続できません。

このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Auto Apply Drivers Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_AutoApplyDrivers)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ドライバー]** を選んで、**[ドライバーの自動適用]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **最適な互換ドライバーのみをインストールする**  
 タスク シーケンス ステップで、検出された各ハードウェア デバイスに最適なドライバーのみをインストールするように指定します。  

 **すべての互換ドライバーをインストールする**  
 タスク シーケンスは検出された各ハードウェア デバイスごとに、互換性のあるすべてのドライバーをインストールします。 その後、Windows セットアップが最善のドライバーを選びます。 このオプションでは、他のオプションより多くのネットワーク帯域幅とディスク領域が使われます。 タスク シーケンスによってダウンロードされるドライバーの数は多くなりますが、Windows はより適切なドライバーを選べます。  

 **すべてのカテゴリのドライバーを検討する**  
 タスク シーケンスは、利用可能なすべてのドライバー カテゴリから適切なデバイス ドライバーを検索します。  

 **ドライバーの一致条件を制限して、選択したカテゴリに属するドライバーだけを検討する**  
 タスク シーケンスは、指定したドライバー カテゴリから適切なデバイス ドライバーを検索します。  

 **署名されていないドライバーの無人インストールが許可されているバージョンの Windows でドライバーの無人インストールを行う**  
 このオプションを指定すると、Windows はデジタル署名のないドライバーをインストールできます。   

  > [!IMPORTANT]  
  >  このオプションは、ドライバーの署名ポリシーを構成できないオペレーティング システムには適用されません。  



##  <a name="BKMK_CaptureNetworkSettings"></a> ネットワーク設定のキャプチャ  
 このステップでは、タスク シーケンスを実行しているコンピューターから Microsoft ネットワーク設定をキャプチャします。 タスク シーケンスは、これらの設定をタスク シーケンス変数に保存します。 これらの設定は、**[ネットワーク設定の適用]** ステップで構成された既定の設定を上書きします。  

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Capture Network Settings Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_CaptureNetworkSettings)」を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[設定]** を選んで、**[ネットワーク設定のキャプチャ]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ドメインとワークグループのメンバーシップを移行する**  
 対象のコンピューターのドメインおよびワークグループ メンバーシップ情報をキャプチャします。  

 **ネットワーク アダプター構成を移行する**  
 対象のコンピューターのネットワーク アダプター構成をキャプチャします。 キャプチャされた情報には、グローバル ネットワーク設定、アダプター数、各アダプターに関連付けられているネットワーク設定が含まれます。 これらの設定には、DNS、WINS、IP、ポート フィルターに関連付けられている設定が含まれます。  



##  <a name="BKMK_CaptureOperatingSystemImage"></a> オペレーティング システム イメージのキャプチャ  
 このステップは、参照コンピューターから 1 つまたは複数のイメージをキャプチャします。 タスク シーケンスは、指定したネットワーク共有上に Windows イメージ (.wim) ファイルを作成します。 その後、**オペレーティング システム イメージの追加**ウィザードを使って、イメージ ベースのオペレーティング システムの展開用に、このイメージを Configuration Manager にインポートします。  

 Configuration Manager は、参照コンピューターから各ボリューム (ドライブ) を、.wim ファイル内の個別のイメージにキャプチャします。 参照コンピューターに複数のボリュームがある場合、作成される .wim ファイルには、ボリュームごとに異なるイメージが含まれています。 NTFS または FAT32 としてフォーマットされているボリュームのみがキャプチャされます。 その他のフォーマットのボリュームおよび USB のボリュームはスキップされます。  

 参照コンピューターにインストールされているオペレーティング システムは、Configuration Manager がサポートするバージョンの Windows である必要があります。 SysPrep ツールを使って、参照コンピューターのオペレーティング システムを準備します。 インストールされたオペレーティング システムのボリュームとブート ボリュームは同じである必要があります。  

 選んだネットワーク共有への書き込みアクセス許可を持つアカウントを指定します。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Capture Operating System Image Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_CaptureOperatingSystemImage)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[オペレーティング システム イメージのキャプチャ]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ターゲット**  
 キャプチャしたオペレーティング システム イメージの保存時に Configuration Manager が使用する場所へのファイル システムのパス名。  

 **説明**  
 .WIM ファイルに保存されるキャプチャ済みオペレーティング システム イメージについて、ユーザーが任意に定義した説明。  

 **バージョン**  
 キャプチャしたオペレーティング システム イメージに割り当てる、ユーザーが任意に定義したバージョン番号。 この値は、文字および数値の任意の組み合わせにすることができ、.WIM ファイルに保存されます。  

 **作成者**  
 オペレーティング システム イメージを作成したユーザーのオプションの名前であり、WIM ファイルに保存されます。  

 **オペレーティング システム イメージのキャプチャ アカウント**  
 指定したネットワーク共有へのアクセス許可がある Windows アカウントを入力する必要があります。 その Windows アカウントの名前を指定するには、**[設定]** をクリックします。  



##  <a name="BKMK_CaptureUserState"></a> ユーザー状態のキャプチャ  
 このステップでは、ユーザー状態移行ツール (USMT) を使って、タスク シーケンスを実行しているコンピューターからユーザーの状態と設定をキャプチャします。 このタスク シーケンス ステップは、**[ユーザー状態の復元]** タスク シーケンス ステップと共に使用します。 USMT 3.0.1 以降では、このオプションにより Configuration Manager が生成および管理する暗号化キーを使った USMT 状態ストアの暗号化が必ず行われます。  

 オペレーティング システムを展開するときに、ユーザー状態の移行を管理する方法の詳細については、「[Manage user state](../get-started/manage-user-state.md)」 (ユーザー状態の管理) を参照してください。  

 ユーザーの状態設定を状態移行ポイントに保存したり、状態移行ポイントから復元したりする場合は、**[ユーザー状態のキャプチャ]** ステップを、**[状態ストアの要求]** ステップおよび **[状態ストアのリリース]** ステップと共に使います。  

 **[ユーザー状態のキャプチャ]** タスク シーケンス ステップにより、最も一般的に使用されているオプションの限定されたサブセットが制御できます。 その他のコマンド ライン オプションは、OSDMigrateAdditionalCaptureOptions タスク シーケンス 変数を使用して指定できます。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Capture User State Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_CaptureUserState)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ユーザー状態]** を選んで、**[ユーザー状態のキャプチャ]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ユーザー状態移行ツール パッケージ**  
 ユーザー状態移行ツール (USMT) を含むパッケージを指定します。 タスク シーケンスは、このバージョンの USMT を使って、ユーザーの状態と設定をキャプチャします。 このパッケージにはプログラムは必要ありません。 32 ビット バージョンまたは 64 ビット バージョンの USMT を含むパッケージを指定します。 USMT のアーキテクチャは、タスク シーケンスが状態をキャプチャするオペレーティング システムのアーキテクチャによって異なります。  

 **すべてのユーザー プロファイルを標準オプションでキャプチャする**  
 すべてのユーザー プロファイル情報を移行します。 これは既定のオプションです  

 このオプションを選んでも、**[ユーザー状態の復元]** ステップで **[ローカル コンピューターのユーザー プロファイルを復元する]** を選ばないと、タスク シーケンスは失敗します。 新しいアカウントにパスワードを割り当てないと、Configuration Manager は新しいアカウントを移行できません。 

 **タスク シーケンスの新規作成**ウィザードの **[既存のイメージ パッケージをインストールする]** オプションを使うと、作成されるタスク シーケンスでは **[すべてのユーザー プロファイルを標準オプションでキャプチャする]** が既定でオンになります。 この既定のタスク シーケンスでは、**[ローカル コンピューターのユーザー プロファイルを復元する]** オプション (つまり、非ドメイン ユーザー アカウント) が選ばれません。  

 **[ローカル コンピューターのユーザー プロファイルを復元する]** を選択し、移行するアカウントのパスワードを指定します。 手動で作成したタスク シーケンスでは、この設定は [ユーザー状態の復元] タスク シーケンス ステップにあります。 **タスク シーケンスの新規作成** ウィザードで作成したタスク シーケンスでは、この設定は、**[ユーザー ファイルと設定の復元]** ステップのウィザードのページにあります。  

 ローカル ユーザー アカウントがない場合、この設定は適用されません。  

 **ユーザー プロファイルのキャプチャ方法をカスタマイズする**  
 カスタム プロファイル ファイルの移行を指定するには、このオプションを選択します。 **[ファイル]** をクリックして、このステップで使用する USMT の構成ファイルを選択します。 移行するユーザー状態ファイルを定義する規則を含むカスタムの .xml ファイルを指定します。  

 **構成ファイルを選択するには、ここをクリックします。**  
 ユーザー プロファイルをキャプチャするために使用する、USMT パッケージ内の構成ファイルを選択するには、このオプションを選択します。 **[ファイル]** クリックして、**[構成ファイル]** ダイアログ ボックスを表示します。 構成ファイルを指定するには、**[ファイル名]** 行にファイルの名前を入力し、**[追加]** をクリックします。  

 **詳細ログ記録を有効にする**  
 詳細なログ ファイル情報を生成するには、このオプションを有効にします。 状態をキャプチャすると、タスク シーケンスは既定でタスク シーケンス ログ フォルダー \windows\system32\ccm\logs に ScanState.log を生成します。   

 **暗号化されたファイル システム (EFS) を使用するファイルをスキップする**  
 暗号化されたファイル システム (EFS) で暗号化されたファイルのキャプチャをスキップするには、このオプションを有効にします。 このようなファイルには、ユーザー プロファイル ファイルが含まれます。 オペレーティング システムや USMT バージョンによっては、暗号化されたファイルを復元しても読み取れない場合があります。 詳細については、USMT のドキュメントを参照してください。  

 **ファイル システム アクセスを使用してコピーする**  
 次の設定のいずれかを指定する場合にこのオプションを有効にします。  

-   **キャプチャできないファイルがあっても続行する**: 一部のファイルをキャプチャできない場合でも移行処理を続行するには、この設定を有効にします。 このオプションを無効にした場合、ファイルをキャプチャできないと、このステップは失敗します。 既定では、このオプションは有効になっています。  

-   **ファイルをコピーする代わりに、リンクを使用してローカルでキャプチャする**: NTFS ハードリンクを使用してファイルをキャプチャするには、この設定を有効にします。  

     ハードリンクを使用したデータ移行の詳細については、「 [ハードリンク移行ストア](http://go.microsoft.com/fwlink/p/?LinkId=240222)」を参照してください。  

-   **オフライン モードでキャプチャする (Windows PE のみ)**: 完全なオペレーティング システムではなく、Windows PE でユーザー状態をキャプチャするには、この設定を有効にします。  
    
**ボリューム シャドウ コピー サービス (VSS) を使用してキャプチャする**  
 このオプションを指定すると、ファイルが他のアプリケーションによる編集のためにロックされている場合でもそのファイルをキャプチャできます。  



##  <a name="BKMK_CaptureWindowsSettings"></a> Windows 設定のキャプチャ  
 このステップでは、タスク シーケンスを実行しているコンピューターから Windows の設定をキャプチャします。 タスク シーケンスは、これらの設定をタスク シーケンス変数に保存します。 これらのキャプチャされた設定は、**Windows 設定の適用**ステップで構成された既定の設定を上書きします。  

 このタスク シーケンスのステップは Windows PE または標準のオペレーティング システムで実行されます。 このアクションのタスク シーケンス変数の詳細については、「 [Capture Windows Settings Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_CaptureWindowsSettings)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[設定]** を選んで、**[Windows 設定のキャプチャ]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **コンピューター名を移行する**  
 コンピューターの NetBIOS コンピューター名をキャプチャします。  

 **登録されているユーザーと組織名を移行する**  
 登録されているユーザーと組織名をコンピューターからキャプチャします。  

 **タイム ゾーンを移行する**  
 コンピューターのタイム ゾーンの設定をキャプチャします。  



##  <a name="BKMK_CheckReadiness"></a> 準備の確認  
 このステップでは、指定した展開の前提条件を対象のコンピューターが満たしていることを確認します。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[準備の確認]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **最小メモリ容量 (MB) を確認する**  
 メモリの量 (メガバイト (MB) 単位) が指定した量以上であることを確認します。 この設定は既定で有効になります。  

 **最低プロセッサ速度 (MHz) を確認する**  
 プロセッサの速度 (メガヘルツ (MHz) 単位) が指定した速度以上であることを確認します。 この設定は既定で有効になります。  

 **最小空きディスク容量 (MB) を確認する**  
 空きディスク領域 (メガバイト (MB) 単位) が指定した量以上であることを確認します。  

 **現在の OS の更新を確認する**  
 対象のコンピューターにインストールされているオペレーティング システムが指定した要件を満たすことを確認します。 これは既定で **[クライアント]** に設定されます。  

### <a name="options"></a>Options
 > [!NOTE]  
 > このステップの **[オプション]** タブで **[エラー時に続行する]** の設定を有効にした場合、準備の確認結果の記録だけが行われます。 確認が失敗しても、タスク シーケンスは停止しません。



##  <a name="BKMK_ConnectToNetworkFolder"></a> ネットワーク フォルダーへの接続  
 このステップでは、共有ネットワーク フォルダーへの接続を作成します。  

 このタスク シーケンス ステップは標準のオペレーティング システムまたは Windows PE で実行できます。 このアクションのタスク シーケンス変数の詳細については、「 [Connect to Network Folder Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_ConnecttoNetworkFolder)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[ネットワーク フォルダーに接続]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **パス**  
 **[参照]** をクリックして、ネットワーク フォルダーのパスを指定します。 "*\\\server\share*" の形式を使います。

 **ドライブ**  
 この接続に割り当てるローカル ドライブ文字を選びます。 

 **アカウント**  
 **[設定]** をクリックして、このネットワーク フォルダーに接続するアクセス許可を持つユーザー アカウントを指定します。



##  <a name="BKMK_DisableBitLocker"></a> BitLocker の無効化  
 このステップでは、現在のオペレーティング システム ドライブまたは特定のドライブでの BitLocker 暗号化を無効にします。 この操作では、キー プロテクターがハード ドライブ上にクリア テキストで表示されますが、ドライブの内容は解読されません。 結果として、このアクションはほぼ瞬時に完了します。  

> [!NOTE]  
>  BitLocker ドライブ暗号化とは、ディスク ボリュームの内容を低レベルで暗号化する処理のことです。  

 複数のドライブを暗号化している場合は、オペレーティング システム ドライブで BitLocker を無効にする前に、すべてのデータ ドライブで BitLocker を無効にする必要があります。  

 このステップは標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ディスク]** を選んで、**[BitLocker の無効化]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **現在のオペレーティング システム ドライブ**  
 現在のオペレーティング システム ドライブで BitLocker を無効にします。  

 **特定のドライブ**  
 特定のドライブで BitLocker を無効にします。 ドロップダウン リストを使用して、BitLocker を無効にするドライブを指定します。  



##  <a name="BKMK_DownloadPackageContent"></a> パッケージ コンテンツのダウンロード  
 このステップでは、次のいずれかの種類のパッケージをダウンロードします。  

-   オペレーティング システム イメージ  

-   オペレーティング システムのアップグレード パッケージ  

-   ドライバー パッケージ  

-   パッケージ  
    
このステップは、次のシナリオでオペレーティング システムをアップグレードするためのタスク シーケンスに適しています。  

-   x86 と x64 の両方のプラットフォームで動作する 1 つのアップグレード タスク シーケンスを使用する。 **[アップグレードの準備]** グループで 2 つの **[パッケージ コンテンツのダウンロード]** ステップを含めます。 **[オプション]** タブでクライアント アーキテクチャを検出する条件を指定し、適切な OS アップグレード パッケージのみをダウンロードします。 同じ変数を使用するように **[パッケージ コンテンツのダウンロード]** ステップをそれぞれ構成します。 **[オペレーティング システムのアップグレード]** ステップでメディア パスにその変数を使います。  

-   該当するドライバー パッケージを動的にダウンロードするには、ドライバー パッケージごとに適切なハードウェアの種類を検出する条件を含む 2 つの **[パッケージ コンテンツのダウンロード]** ステップを使用します。 同じ変数を使用するように **[パッケージ コンテンツのダウンロード]** ステップをそれぞれ構成します。 **[オペレーティング システムのアップグレード]** ステップの [ドライバー] セクションの **[ステージング済みコンテンツ]** の値にその変数を使います。  

> [!NOTE]    
> パッケージ コンテンツのダウンロード ステップを含むタスク シーケンスを展開する場合、ソフトウェアの展開ウィザードの **[配布ポイント]** ページで、**[展開オプション]** に **[タスク シーケンスを開始する前にすべてのコンテンツをローカルにダウンロードする]** または **[配布ポイントからコンテンツに直接アクセスする]** を選ばないでください。  

このステップは標準のオペレーティング システムまたは Windows PE で実行できます。 ただし、Configuration Manager クライアント キャッシュにパッケージを保存するオプションは、WinPE ではサポートされません。

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ソフトウェア]** を選んで、**[パッケージ コンテンツのダウンロード]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **[パッケージの選択]** アイコン  
 アイコンをクリックして、ダウンロードするパッケージを選択します。 パッケージを選択した後、もう一度アイコンをクリックすると、別のパッケージを選択できます。  

 **次の場所に保存する**  
 次のいずれかの場所にパッケージを保存する場合に選択します。  

 -   **タスク シーケンス作業ディレクトリ**  

 -   **Configuration Manager クライアント キャッシュ**: クライアント キャッシュにコンテンツを格納します。 クライアントは、他のピア キャッシュ クライアントのピア キャッシュ ソースとして機能します。 詳細については、「[WAN トラフィックを削減するための Windows PE ピア キャッシュの準備](../get-started/prepare-windows-pe-peer-cache-to-reduce-wan-traffic.md)」を参照してください。  

 -    **カスタム パス**: このオプションにより、タスク シーケンス エンジンは、まず、タスク シーケンス作業ディレクトリにパッケージをダウンロードし、次に、指定したパスに移動します。 タスク シーケンス エンジンが、パッケージ ID を使用してパスを追加します。 
   
**パスを変数として保存する**  
 パスは、別のタスク シーケンスのステップで使用できる変数として保存できます。 Configuration Manager によって、数字のサフィックスが変数名に追加されます。 たとえば、カスタム変数として変数 %*mycontent*% を指定した場合、それは参照されているすべてのコンテンツをタスク シーケンスが格納する場所のルートになります。 このコンテンツには、複数のパッケージを含めることができます。 その場合は、変数を参照するときに、数字のサフィックスを追加します。 たとえば、最初のパッケージの場合は、%*mycontent01*% を参照します。 **オペレーティング システムのアップグレード**など、後続のステップで変数を参照するときは、%*mycontent02*% または %*mycontent03*% を使います。この数字は、**[パッケージ コンテンツのダウンロード]** ステップでのパッケージのリスト順に対応します。  

**パッケージのダウンロードに失敗した場合に、リストにある他のパッケージのダウンロードを続行する**  
 タスク シーケンスでパッケージのダウンロードが失敗した場合は、リスト内の次のパッケージのダウンロードを開始します。  



##  <a name="BKMK_EnableBitLocker"></a> BitLocker の有効化  
このステップでは、BitLocker 暗号化をハード ドライブの少なくとも 2 つのパーティションで有効にします。 片方のアクティブなパーティションには Windows のブートストラップ コードを格納します。 もう片方のパーティションにはオペレーティング システムを格納します。 ブートストラップのパーティションは暗号化されていない必要があります。  

Windows PE のドライブで BitLocker を有効にするには、**[BitLocker の事前プロビジョニング]** タスク シーケンス ステップを使用します。 詳細については、「[BitLocker の事前プロビジョニング](#BKMK_PreProvisionBitLocker)」セクションを参照してください。  

> [!NOTE]  
>  BitLocker ドライブ暗号化とは、ディスク ボリュームの内容を低レベルで暗号化する処理のことです。  

**[BitLocker の有効化]** ステップは標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Enable BitLocker Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_EnableBitLocker)」を参照してください。  

**[TPM のみ]**、**[TPM と、USB 上のスタートアップ キー]**、または **[TPM および PIN]** を指定する場合、**[BitLocker の有効化]** ステップを実行するには、先にトラステッド プラットフォーム モジュール (TPM) を次の状態にする必要があります。  

-   Enabled  
-   アクティブ  
-   所有権を許可  
   
このステップは、残りの TPM 初期化をすべて完了します。 残りのステップでは、物理的な操作や再起動は必要ありません。 必要な場合、**[BitLocker の有効化]** ステップは残りの TPM 初期化ステップを透過的に完了します。  

-   承認キー ペアの作成  
-   所有権の承認値の作成、およびこの値をサポートするために拡張されている Active Directory への仲介  
-   所有権の取得  
-   ストレージ ルート キーの作成、または既に存在しているが互換性がない場合は、リセット  
   
**[BitLocker の有効化]** ステップがドライブの暗号化処理を完了するまでタスク シーケンスを待機させる場合は、**[待機]** オプションを選びます。 **[待機]** オプションを選ばないと、ドライブの暗号化処理はバックグラウンドで行われます。 タスク シーケンスは、すぐに次のステップに進みます。  

BitLocker を使用して、コンピューター システムの複数のドライブ (オペレーティング システムとデータ ドライブの両方) を暗号化することができます。 データ ドライブを暗号化するには、最初にオペレーティング システム ドライブを暗号化して、暗号化処理を完了します。 このような手順が必要であるのは、オペレーティング システム ドライブがデータ ドライブのキー プロテクターを格納しているためです。 オペレーティング システム ドライブとデータ ドライブを同じタスク シーケンスで暗号化する場合は、オペレーティング システム ドライブの **[BitLocker の有効化]** ステップで **[待機]** オプションを選びます。  

ハード ドライブが既に暗号化されている場合に、BitLocker を無効にすると、**[BitLocker の有効化]** ステップはキー プロテクターを再度有効にして、すぐに完了します。 この場合、ハード ドライブの再暗号化は不要です。  

このアクションのタスク シーケンス変数の詳細については、「 [Enable BitLocker Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_EnableBitLocker)」を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ディスク]** を選んで、**[BitLocker の有効化]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **暗号化するドライブの指定**  
 暗号化するドライブを指定します。 現在のオペレーティング システム ドライブを暗号化するには、**[現在のオペレーティング システム ドライブ]** を選択し、次のキー管理オプションのいずれかを構成します。  

-   **TPM のみ**: トラステッド プラットフォーム モジュール (TPM) のみを使用する場合に選択します。  

-   **USB 上のスタートアップ キーのみ**: USB フラッシュ ドライブに格納されているスタートアップ キーを使用する場合に選択します。 このオプションを選択すると BitLocker は、BitLocker スタートアップ キーが含まれている USB デバイスがコンピューターに接続されるまで、通常のブート プロセスをロックします。  

-   **TPM と、USB 上のスタートアップ キー**: TPM と、USB フラッシュ ドライブに格納されているスタートアップ キーを使用する場合に選択します。 このオプションを選択すると BitLocker は、BitLocker スタートアップ キーが含まれている USB デバイスがコンピューターに接続されるまで、通常のブート プロセスをロックします。  

-   **TPM および PIN**: TPM と個人識別番号 (PIN) を使用する場合に選択します。 このオプションを選択すると BitLocker は、ユーザーが PIN を入力するまで、通常のブート プロセスをロックします。  
   
オペレーティング システム以外の特定のデータ ドライブを暗号化するには、**[特定のドライブ]** を選択し、一覧からドライブを選択します。  

**リカバリ キーの作成先の指定**  
 リカバリ パスワードを作成して Active Directory にエスクローするよう指定するには、**[In Active Directory]\(Active Directory 内\)** を選びます。 このオプションを選ぶ場合は、サイトの Active Directory を拡張する必要があります。 そうすると、BitLocker は関連付けられているリカバリ情報を Active Directory に保存できます。 パスワードを作成しない場合は、**[Do not create recovery key]\(リカバリ キーを作成しない\)** を選びます。 パスワードを作成するのがベスト プラクティスです。  

**BitLocker がすべてのドライブの暗号化処理を完了してから、タスク シーケンスを実行する**  
 このオプションを選ぶと、BitLocker のドライブ暗号化が完了してから、タスク シーケンスの次のステップが実行されます。 このオプションを選んだ場合は、ユーザーがコンピューターにログインできるようになる前に、BitLocker はディスク ボリューム全体を暗号化します。  

大容量のハード ドライブを暗号化する場合、暗号化処理の完了に数時間かかることがあります。 このオプションを選ばないと、タスク シーケンスは直ちに続行されます。  



##  <a name="BKMK_FormatandPartitionDisk"></a> ディスクのフォーマットとパーティション作成  
 このステップでは、対象のコンピューター上の指定したディスクをフォーマットしてパーティションを作成します。  

> [!IMPORTANT]  
>  このタスク シーケンスのステップで指定するすべての設定は、1 つの指定されたディスクにだけ適用されます。 対象コンピューターの別のディスクのフォーマットとパーティション作成を行う場合は、別の **[ディスクのフォーマットとパーティション作成]** ステップをタスク シーケンスに追加します。  

 このタスク シーケンス ステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このアクションのタスク シーケンス変数の詳細については、「 [Format and Partition Disk Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_FormatPartitionDisk)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ディスク]** を選んで、**[ディスクのフォーマットとパーティション作成]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ディスク番号**  
 フォーマットするディスクの物理ディスク番号です。 この番号は、Windows のディスク列挙の順番に基づいています。  

 **ディスクの種類**  
 フォーマットされるディスクの種類。 ドロップダウン リストには次の 2 つのオプションがあります。 

-   標準 (MBR) - マスター ブート レコード
-   GPT – GUID パーティション テーブル  

> [!NOTE]  
>  ディスクの種類を **[標準 (MBR)]** から **[GPT]** に変更し、パーティション レイアウトの中に拡張パーティションが存在している場合、タスク シーケンスはすべての拡張パーティションと論理パーティションをレイアウトから削除します。 タスク シーケンス エディターでは、ディスクの種類が変更される前に、このアクションを実行するかどうかを確認するメッセージが表示されます。  
   
**ボリューム**  
 タスク シーケンスで作成されるパーティションまたはボリュームに関する詳細な情報です。次の情報が含まれます。  

-   名前  
-   ディスクの空き容量  
   
新しいパーティションを作成するには、**[新規]** ボタンをクリックして、**[パーティションのプロパティ]** ダイアログ ボックスを開きます。 パーティションの種類とサイズ、およびブート パーティションかどうかを指定します。 既存のパーティションを変更するには、変更するパーティションをクリックしてから、プロパティ ボタンをクリックします。 ハード ドライブのパーティションを構成する方法については、次のいずれかの記事を参照してください。  

-   [UEFI GPT ベースのハード ドライブのパーティションを構成する方法](http://go.microsoft.com/fwlink/?LinkID=272104)  
-   [BIOS MBR ベースのハード ドライブのパーティションを構成する方法](http://go.microsoft.com/fwlink/?LinkId=272105)  

パーティションを削除するには、削除するパーティションを選択してから、**[削除]** をクリックします。  



##  <a name="BKMK_InstallApplication"></a> アプリケーションのインストール  
このステップでは、指定したアプリケーション、またはタスク シーケンス変数の動的なリストによって定義したアプリケーションのセットがインストールされます。 このステップが実行されると、アプリケーションのインストールはポリシーのポーリング間隔を待たずにすぐ開始されます。  

インストールされるアプリケーションは、次の条件を満たしている必要があります。  

-   アプリケーションの展開の種類は、Windows インストーラーかスクリプト インストーラーでなければなりません。 Windows アプリ パッケージ (.appx ファイル) の展開の種類はサポートされていません。  

-   ユーザー アカウントではなく、ローカル システム アカウントで実行する必要があります。  

-   デスクトップと通信してはいけません。 プログラムは、サイレントまたは無人モードで実行する必要があります。  

-   自動的に再起動を開始させてはいけません。 アプリケーションは、標準再起動コードの 3010 終了コードを使用して再起動を要求する必要があります。 この動作により、タスク シーケンス ステップで再起動が正しく処理されるようになります。 アプリケーションが 3010 終了コードを返さない場合は、基本となるタスク シーケンス エンジンが再起動を実行します。 再起動後にタスク シーケンスは自動的に続行されます。  

**アプリケーションのインストール** ステップが実行されると、アプリケーションは、アプリケーションの展開の種類で要件ルールと検出方法が適用可能かどうかを確認します。 この確認の結果によって、アプリケーションは適用される展開の種類をインストールします。 展開の種類が依存関係を含んでいる場合は、アプリケーションのインストール ステップの一環として依存する展開の種類が評価され、インストールされます。 スタンドアロン メディアでは、アプリケーションの依存関係はサポートされていません。  

> [!NOTE]  
>  別のアプリケーションを置き換えるアプリケーションをインストールするには、置換対象のアプリケーションのコンテンツ ファイルを使用可能である必要があります。 使用できない場合、タスク シーケンス ステップは失敗します。 たとえば、Microsoft Visio 2010 は、クライアント、または、キャプチャされたイメージ内にインストールされます。 **[アプリケーションのインストール]** ステップで Microsoft Visio 2013 をインストールする場合は、Microsoft Visio 2010 (置換対象のアプリケーション) のコンテンツ ファイルが配布ポイントで利用できる必要があります。 クライアントまたはキャプチャされたイメージに Microsoft Visio がインストールされていない場合、タスク シーケンスは Microsoft Visio 2010 のコンテンツ ファイルのチェックを行わずに、Microsoft Visio 2013 をインストールします。  

> [!NOTE]
> クライアントがロケーション サービスから管理ポイント リストを取得できない場合は、SMSTSMPListRequestTimeoutEnabled および SMSTSMPListRequestTimeout 組み込み変数を使って、タスク シーケンスがアプリケーションまたはソフトウェア更新プログラムのインストールを再試行するまで待機するミリ秒数を指定します。 組み込みのタスク シーケンス変数の詳細については、「[タスク シーケンス組み込み変数](task-sequence-built-in-variables.md)」を参照してください。

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ソフトウェア]** を選んで、**[アプリケーションのインストール]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **次のアプリケーションをインストールする**  
 タスク シーケンスは、指定した順序でこれらのアプリケーションをインストールします。  

 Configuration Manager は、無効なアプリケーションまたは次のように設定されたアプリケーションを除外します。  

-   ユーザーがログオンしているときのみ  
-   ユーザーの権限で実行する  

これらのアプリケーションは、**[インストールするアプリケーションの選択]** ダイアログ ボックスには表示されません。
  
**動的な変数一覧に従ってアプリケーションをインストールする**  
タスク シーケンスは、この基本変数名を使ってアプリケーションをインストールします。 基本変数名は、コレクションまたはコンピューターに対して定義されているタスク シーケンス変数のセットに対するものです。 これらの変数では、タスク シーケンスがそのコレクションまたはコンピューターに対してインストールするアプリケーションを指定します。 各変数名は、共通のベース名と「01」で始まる数字のサフィックスで構成されます。 各変数の値にはアプリケーションの名前以外は何も含んではいけません。  

動的な変数一覧を使ってアプリケーションをインストールする場合は、アプリケーションの **[プロパティ]** の **[全般]** タブで、設定 **[このアプリケーションを展開せずに [アプリケーションのインストール] タスク シーケンスでインストールできるようにする]** を有効にします。  

> [!NOTE]  
>  スタンドアロン メディアによる展開では動的な変数一覧を使用してアプリケーションをインストールすることはできません。  

たとえば、AA01 というタスク シーケンス変数を使用して 1 つのアプリケーションをインストールするには、次の変数を指定します。  

|変数名|変数値|  
|-------------------|--------------------|  
|AA01|Microsoft Office|  

2 つのアプリケーションをインストールするには、次の変数を指定します。  

|変数名|変数値|  
|-------------------|--------------------|  
|AA01|Microsoft Lync|  
|AA02|Microsoft Office|  

次の条件は、タスク シーケンスによってインストールされるアプリケーションに影響を与えます。  

-   変数の値にアプリケーションの名前以外が含まれている場合。 タスク シーケンスはアプリケーションをインストールせず、タスク シーケンスが続行します。  

-   タスク シーケンスは、指定された基本名とサフィックス "01" を持つ変数が見つからない場合は、どのアプリケーションもインストールしません。 
   
**アプリケーションのインストールに失敗した場合は、一覧にあるその他のアプリケーションのインストールを続行します。**  
 この設定は、個々のアプリケーションのインストールが失敗してもステップを続行することを指定します。 この設定を指定すると、タスク シーケンスはインストール エラーに関係なく続行されます。 この設定を指定しないと、インストールが失敗した場合はステップが直ちに終了します。  

### <a name="options"></a>Options
 > [!NOTE] 
 > このステップの **[オプション]** タブで **[エラー時に続行する]** を選ぶと、アプリケーションのインストールが失敗した場合でも、タスク シーケンスは続行されます。 このオプションを有効にしないと、タスク シーケンスは失敗し、残りのアプリケーションはインストールされません。  
 
このタスク シーケンス ステップの **[オプション]** タブでは、既定のオプションだけでなく、以下の追加設定を構成します。  

-   **コンピューターが予期せず再起動した場合にこの手順を再試行する**  
    アプリケーションのインストールのいずれかでコンピューターが予期せず再起動された場合は、このステップを再試行します。 この設定は既定で有効になり、再試行回数は 2 回に設定されます。 再試行回数は 1 から 5 回の範囲で指定できます。  



##  <a name="BKMK_InstallPackage"></a> パッケージのインストール
このステップでは、タスク シーケンスの一部としてソフトウェア パッケージをインストールします。 このステップが実行されると、インストールはポリシーのポーリング間隔を待たずにすぐ開始されます。  

パッケージは次の条件を満たす必要があります。  

-   ユーザー アカウントではなく、ローカル システム アカウントで実行する必要があります。  

-   デスクトップと通信してはいけません。 プログラムは、サイレントまたは無人モードで実行する必要があります。  

-   自動的に再起動を開始させてはいけません。 ソフトウェアは、標準再起動コードの 3010 終了コードを使用して再起動を要求する必要があります。 この動作により、タスク シーケンス ステップは再起動を適切に処理するようになります。 ソフトウェアが 3010 終了コードを返さない場合、基になっているタスク シーケンス エンジンはコンピューターを再起動します。 再起動後にタスク シーケンスは自動的に続行されます。  

依存プログラムのインストールに **[別のプログラムを最初に実行する]** オプションを使用するプログラムは、オペレーティング システムの展開ではサポートされていません。 パッケージ オプション **[別のプログラムを最初に実行する]** が有効になっていて、依存プログラムが対象のコンピューターで既に実行された場合は、依存プログラムが実行されて、タスク シーケンスは続行します。 一方、依存プログラムが対象のコンピューターでまだ実行されていない場合は、タスク シーケンスは失敗します。  

> [!NOTE]  
>  中央管理サイトには、タスク シーケンスの間にソフトウェア配布エージェントを有効にするために必要なクライアント構成ポリシーがありません。 中央管理サイトのタスク シーケンス用にスタンドアロン メディアを作成し、タスク シーケンスに **[パッケージのインストール]** ステップが含まれる場合、CreateTsMedia.log ファイルに次のエラーが表示される場合があります。  
>   
>  `"WMI method SMS_TaskSequencePackage.GetClientConfigPolicies failed (0x80041001)"`  
>   
>  **[パッケージのインストール]** ステップを含むスタンドアロン メディアの場合は、ソフトウェア配布エージェントが有効になっているプライマリ サイトでスタンドアロン メディアを作成します。 または、**[Windows と ConfigMgr のセットアップ]** ステップの後、最初の **[パッケージのインストール]** ステップの前に、**[コマンド ラインの実行]** ステップを追加します。 **[コマンド ラインの実行]** ステップは、最初の **[パッケージのインストール]** ステップの前に、WMIC コマンドを実行してソフトウェア配布エージェントを有効にします。 **[コマンド ラインの実行]** ステップでは次のコマンドを使います。  
>   
>  **コマンド ライン**: `WMIC /namespace:\\\root\ccm\policy\machine\requestedconfig path ccm_SoftwareDistributionClientConfig CREATE ComponentName="Enable SWDist", Enabled="true", LockSettings="TRUE", PolicySource="local", PolicyVersion="1.0", SiteSettingsKey="1" /NOINTERACTIVE`  
>   
>  スタンドアロン メディアの作成の詳細については、「[スタンドアロン メディアの作成](../deploy-use/create-stand-alone-media.md)」を参照してください。  

このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ソフトウェア]** を選んで、**[パッケージのインストール]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ソフトウェア パッケージを 1 つだけインストールする**  
 この設定では、Configuration Manager ソフトウェア パッケージを指定します。 ステップはインストールが完了するまで待ちます。  

 **動的な変数一覧に従ってソフトウェア パッケージをインストールする**  
 タスク シーケンスは、この基本変数名を使ってパッケージをインストールします。 基本変数名は、コレクションまたはコンピューターに対して定義されているタスク シーケンス変数のセットに対するものです。 これらの変数では、タスク シーケンスがそのコレクションまたはコンピューターに対してインストールするパッケージを指定します。 各変数名は、共通のベース名と「001」で始まる数字のサフィックスで構成されます。 各変数の値にはパッケージ ID およびソフトウェアの名前をコロンで区切って含んでいる必要があります。  

 動的な変数一覧を使ってソフトウェアをインストールする場合は、パッケージの **[プロパティ]** ダイアログ ボックスの **[詳細設定]** タブで、設定 **[展開せずにパッケージのインストール タスク シーケンスでこのプログラムをインストールできるようにする]** を有効にします。  

> [!NOTE]  
>  スタンドアロン メディアによる展開では動的な変数一覧を使用してソフトウェア パッケージをインストールすることはできません。  

 たとえば、AA001 というタスク シーケンス変数を使用して 1 つのソフトウェア パッケージをインストールするには、次の変数を指定します。  

|変数名|変数値|  
|-------------------|--------------------|  
|AA001|CEN00054:Install|  

 3 つのソフトウェア パッケージをインストールするには、次の変数を指定します。  

|変数名|変数値|  
|-------------------|--------------------|  
|AA001|CEN00054:Install|  
|AA002|Package CEN00107:Install Silent|  
|AA003|CEN00031:Install|  

 次の条件は、タスク シーケンスによってインストールされるパッケージに影響を与えます。  

-   変数の値が正しい形式で作成されていない場合、または有効なパッケージ ID と名前が指定されていない場合は、ソフトウェアのインストールは失敗します。  

-   パッケージ ID に小文字が含まれている場合は、ソフトウェアのインストールは失敗します。  

-   タスク シーケンスは、指定された基本名とサフィックス "001" を持つ変数が見つからない場合は、どのパッケージもインストールしません。 タスク シーケンスは続行します。  
   
**ソフトウェア パッケージのインストールに失敗した場合に、一覧にある他のパッケージのインストールを続行する**  
 この設定は個々のソフトウェア パッケージのインストールが失敗してもステップを続行することを指定します。 この設定を指定すると、タスク シーケンスはインストール エラーに関係なく続行されます。 この設定を指定しないと、インストールが失敗した場合はステップが直ちに終了します。  



##  <a name="BKMK_InstallSoftwareUpdates"></a> ソフトウェア更新プログラムのインストール  
このステップでは、ソフトウェア更新プログラムを対象コンピューターにインストールします。 このタスク シーケンス ステップが実行されるまで、対象のコンピューターは適用可能なソフトウェア更新プログラムが評価されません。 実行されると、他の Configuration Manager クライアントと同様に、対象コンピューターでソフトウェアの更新状態が評価されます。 このステップでソフトウェア更新プログラムをインストールするには、最初に、対象コンピューターがメンバーであるコレクションに、更新プログラムを展開する必要があります。  
>  [!IMPORTANT]
> パフォーマンスを最適にするには、最新バージョンの Windows Update エージェントをインストールします。 
>* Windows 7 の場合は、[サポート技術情報 3161647](https://support.microsoft.com/kb/3161647) をご覧ください。
>* Windows 8 の場合は、[サポート技術情報 3163023](https://support.microsoft.com/kb/3163023) をご覧ください。

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「 [Install Software Updates Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_InstallSoftwareUpdates)」を参照してください。

 > [!NOTE]
 > クライアントがロケーション サービスから管理ポイント リストを取得できない場合は、SMSTSMPListRequestTimeoutEnabled および SMSTSMPListRequestTimeout 組み込み変数を使って、タスク シーケンスがアプリケーションまたはソフトウェア更新プログラムのインストールを再試行するまで待機するミリ秒数を指定します。 組み込みのタスク シーケンス変数の詳細については、「[タスク シーケンス組み込み変数](task-sequence-built-in-variables.md)」を参照してください。

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ソフトウェア]** を選んで、**[ソフトウェア更新プログラムのインストール]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **インストールが必要 - 必須のソフトウェア更新プログラムのみ**  
 管理者が定義したインストール期限ですべての必須ソフトウェア更新プログラムをインストールするには、このオプションを選びます。  

 **インストールが可能 - すべてのソフトウェア更新プログラム**  
 利用可能なソフトウェア更新プログラムをすべてインストールするには、このオプションを選びます。 最初に、コンピューターがメンバーであるコレクションにこれらの更新プログラムを展開する必要があります。 タスク シーケンスでは、利用可能なすべてのソフトウェア更新プログラムが対象コンピューターにインストールされます。  

 **キャッシュされたスキャン結果からのソフトウェア更新プログラムの評価**  
 既定では、タスク シーケンスは Windows Update エージェントにあるキャッシュされたスキャン結果を使います。 最新のカタログをソフトウェアの更新ポイントからダウンロードするよう Windows Update エージェントに指示するには、このチェック ボックスをオフにします。 タスク シーケンスを使って[オペレーティング システム イメージをキャプチャして構築する](../deploy-use/create-a-task-sequence-to-capture-an-operating-system.md)場合は、このオプションをオンにします。 このシナリオでは、ソフトウェア更新プログラムの数が多くなる可能性があります。 これらの更新プログラムの多くには依存関係があります (たとえば、Y が該当するものとして認識される前に X をインストールする)。 この設定をオフにし、多数のクライアントにタスク シーケンスを展開すると、すべてのクライアントが同時にソフトウェアの更新ポイントに接続します。 これにより、カタログの処理とダウンロードの間にパフォーマンスの問題が発生します。 ベスト プラクティスは、キャッシュされたスキャン結果を使う既定の設定です。 

SMSTSSoftwareUpdateScanTimeout タスク シーケンス変数は、このステップでのソフトウェア更新プログラムのスキャンのタイムアウトを制御します。 既定値は 30 分です。 組み込みのタスク シーケンス変数の詳細については、「[タスク シーケンス組み込み変数](task-sequence-built-in-variables.md)」を参照してください。

### <a name="options"></a>Options   
 このタスク シーケンス ステップの **[オプション]** タブでは、既定のオプションだけでなく、以下の追加設定を構成します。  

-   **コンピューターが予期せず再起動した場合にこの手順を再試行する**  
    更新プログラムのいずれかでコンピューターが予期せず再起動された場合は、このステップを再試行します。 この設定は既定で有効になり、再試行回数は 2 回に設定されます。 再試行回数は 1 から 5 回の範囲で指定できます。  

    > [!NOTE]
    > このシナリオでコンピューターの再起動後にタスク シーケンスが一時停止する秒数を指定するには、SMSTSWaitForSecondReboot 変数を構成します。 組み込みのタスク シーケンス変数の詳細については、「[タスク シーケンス組み込み変数](task-sequence-built-in-variables.md)」を参照してください。



##  <a name="BKMK_JoinDomainorWorkgroup"></a> ドメインまたはワークグループへの参加  
 このステップでは、対象コンピューターをワークグループまたはドメインに追加します。  

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「 [Join Domain or Workgroup Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_JoinDomainWorkgroup)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[ドメインまたはワークグループへの参加]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ワークグループに参加**  
 対象コンピューターを指定したワークグループに参加させるには、このオプションを選択します。 コンピューターが現在ドメインのメンバーである場合は、このオプションを選ぶとコンピューターが再起動します。  

 **ドメインに参加**  
 対象コンピューターを指定したドメインに参加させるには、このオプションを選択します。  

 必要に応じて、コンピューターが参加する、指定したドメインの組織単位 (OU) を入力または参照して指定します。 現在、コンピューターが他のドメインまたはワークグループのメンバーである場合は、このオプションを選ぶとコンピューターが再起動します。 コンピューターが既に別の OU のメンバーになっている場合、Active Directory Domain Services ではこの方法で OU を変更することはできないので、Windows セットアップはこの設定を無視します。  

 **ドメインに参加する権限のあるアカウントを入力してください**  
 **[設定]** をクリックし、ドメインに参加するアクセス許可を持つアカウントのユーザー名とパスワードを入力します。 "*ドメイン\アカウント*" の形式でアカウントを入力します。  



## <a name="BKMK_PrepareConfigMgrClientforCapture"></a> ConfigMgr クライアントのキャプチャの準備  
このステップでは、参照コンピューター上の Configuration Manager クライアントを削除または構成します。 このアクションは、イメージ作成プロセスの一部としてキャプチャできるようにコンピューターを準備します。

Configuration Manager バージョン 1610 以降の **[ConfigMgr クライアントの準備]** ステップでは、キー情報だけではなく、Configuration Manager クライアントが完全に削除されます。 タスク シーケンスは、キャプチャされたオペレーティング システム イメージを展開するとき、毎回新しい Configuration Manager クライアントをインストールします。  

> [!Note]  
>  タスク シーケンス エンジンは、**[参照オペレーティング システム イメージを構築およびキャプチャする]** タスク シーケンスの間にだけ、クライアントを削除します。 タスク シーケンス エンジンでは、メディアのキャプチャやカスタム タスク シーケンスなど、他のキャプチャ方法でクライアントは削除されません。

Configuration Manager バージョン 1610 より前のこの手順では、次のタスクが実行されます。  

-   クライアント構成プロパティのセクションを、Windows ディレクトリ内の smscfg.ini ファイルから削除します。 このプロパティには、Configuration Manager GUID や他のクライアント識別子など、クライアント固有の情報が含まれます。  

-   すべての SMS または Configuration Manager マシンの証明書を削除します。  

-   Configuration Manager クライアント キャッシュを削除します。  

-   Configuration Manager クライアント用に割り当てられたサイト変数をクリアします。  

-   すべてのローカルの Configuration Manager ポリシーを削除します。  

-   Configuration Manager クライアントの信頼されたルート キーを削除します。  

このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[ConfigMgr クライアントのキャプチャの準備]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップでは、**[プロパティ]** タブでの設定は何も必要ありません。



##  <a name="BKMK_PrepareWindowsforCapture"></a> Windows のキャプチャの準備  
 このステップでは、参照コンピューターのオペレーティング システム イメージをキャプチャするときの Sysprep オプションを指定します。 このタスク シーケンス アクションは、Sysprep を実行した後、タスク シーケンスに指定されている Windows PE ブート イメージでコンピューターを再起動します。 参照コンピューターがドメインに参加している場合、このアクションは失敗します。  

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「 [Prepare Windows for Capture Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_PrepareWindowsCapture)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[Windows のキャプチャの準備]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **大容量記憶装置ドライバーのリストを自動作成する**  
 このオプションをオンにすると、Sysprep によって参照コンピューターから大容量記憶装置ドライバーのリストが自動的に作成されます。 このオプションでは、参照コンピューターの sysprep.inf ファイルにある [大容量記憶装置ドライバーの作成] オプションが有効になります。 この設定については、Sysprep のドキュメントを参照してください。  

 **アクティブ化フラグをリセットしない**  
 このオプションをオンにすると、Sysprep によってプロダクト アクティベーション フラグがリセットされなくなります。  



##  <a name="BKMK_PreProvisionBitLocker"></a> BitLocker の事前プロビジョニング  
 このステップでは、Windows PE のドライブで BitLocker を有効にします。 使用されているドライブ領域のみが暗号化されるため、暗号化にかかる時間が大幅に短くなります。 オペレーティング システムのインストール後に [BitLocker の有効化](#BKMK_EnableBitLocker) タスク シーケンス ステップを使用することで、キー管理オプションを適用します。 このステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。  

> [!IMPORTANT]  
>  BitLocker の事前プロビジョニングには、少なくとも Windows 7 が必要です。 コンピューターでは、サポートされるトラステッド プラットフォーム モジュール (TPM) が有効になっている必要もあります。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ディスク]** を選んで、**[BitLocker の事前プロビジョニング]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **BitLocker を指定のドライブに適用します**  
 BitLocker を有効にするドライブを指定します。 ドライブ上の使用領域のみが暗号化されます。  

 **TPM がないか、TPM が有効ではない場合は、コンピューターでこの手順はスキップされます。**  
 サポートされる TPM または有効な TPM が含まれないコンピューターでのドライブ暗号化をスキップする場合は、このオプションを選びます。 たとえば、仮想マシンにオペレーティング システムを展開するときは、このオプションを使います。  



##  <a name="BKMK_ReleaseStateStore"></a> 状態ストアのリリース  
 このステップでは、キャプチャ アクションまたは復元アクションが完了した状態移行ポイントを通知します。 このステップは、**[状態ストアの要求]**、**[ユーザー状態のキャプチャ]**、**[ユーザー状態の復元]** の各ステップと組み合わせて使います。 状態移行ポイントおよびユーザー状態移行ツール (USMT) を使ってユーザー状態データを移行するには、これらのステップを使います。  

 オペレーティング システムを展開するときに、ユーザー状態の移行を管理する方法の詳細については、「[Manage user state](../get-started/manage-user-state.md)」 (ユーザー状態の管理) を参照してください。  

 **[状態ストアの要求]** ステップを使ってユーザー状態を "*キャプチャ*" するための状態移行ポイントへのアクセスを要求する場合、このステップはキャプチャ プロセスが完了したことを状態移行ポイントに通知します。 状態移行ポイントは、復元に利用可能としてユーザー状態データをマークします。 状態移行ポイントは、復元中のコンピューターのみが読み取り専用でアクセスできるように、ユーザー状態データに対するアクセス制御のアクセス許可を設定します。  

 **[状態ストアの要求]** ステップを使ってユーザー状態を "*復元*" するための状態移行ポイントへのアクセスを要求する場合、このステップは復元プロセスが完了したことを状態移行ポイントに通知します。 その後、状態移行ポイントはその構成済みのデータ保有設定をアクティブにします。  

> [!IMPORTANT]  
>  ベスト プラクティスとしては、**[状態ストアの要求]** ステップと **[状態ストアのリリース]** ステップの間のすべてのステップで、**[エラー時に続行する]** オプションを設定します。 すべての **[状態ストアの要求]** ステップに、対応する **[状態ストアのリリース]** ステップが存在する必要があります。  

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「 [Release State Store Sequence Action Variables](task-sequence-action-variables.md#BKMK_ReleaseStateStore)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ユーザー状態]** を選んで、**[状態ストアのリリース]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップでは、**[プロパティ]** タブでの設定は何も必要ありません。



##  <a name="BKMK_RequestStateStore"></a> 状態ストアの要求  
 このステップでは、状態をキャプチャまたは復元するときに、状態移行ポイントへのアクセスを要求します。  

 オペレーティング システムを展開するときに、ユーザー状態の移行を管理する方法の詳細については、「[Manage user state](../get-started/manage-user-state.md)」 (ユーザー状態の管理) を参照してください。  

 このステップは、**[状態ストアのリリース]**、**[ユーザー状態のキャプチャ]**、**[ユーザー状態の復元]** の各ステップと組み合わせて使います。 状態移行ポイントおよびユーザー状態移行ツール (USMT) を使ってコンピューターの状態を移行するには、これらのステップを使います。  

> [!NOTE]  
>  新しい状態移行ポイントを作成するとき、ユーザー状態ストレージが利用できるようになるまで最大で 1 時間かかることがあります。 利用できるようになるまでの時間を短縮するには、いずれかの状態移行ポイントのプロパティ設定を調整して、サイト コントロール ファイルの更新を開始します。  

 このタスク シーケンス ステップは、標準のオペレーティング システムおよびオフライン USMT の Windows PE に対して実行できます。 このタスク シーケンス アクションのタスク シーケンス変数については、「 [Request State Store Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_RequestState)」を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ユーザー状態]** を選んで、**[状態ストアの要求]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **状態をコンピューターからキャプチャする**  
 状態移行ポイントの設定で構成されている最小要件を満たす状態移行ポイントを検索します。 たとえば、**最大クライアント数**や**空きディスク領域の最小量**などです。 このオプションでは、状態移行時に十分な空き領域があることは保証されません。 このオプションは、ユーザー状態と設定をコンピューターからキャプチャするために状態移行ポイントにアクセスすることを要求します。  

 Configuration Manager サイトに複数のアクティブな状態移行ポイントがある場合、このステップは、使用可能なディスク領域のある状態移行ポイントを検索します。 タスク シーケンスは、状態移行ポイントの一覧で管理ポイントを照会してから、最小要件を満たすものが見つかるまで各ポイントを評価します。  

 **状態を他のコンピューターから復元する**  
 以前にキャプチャされたユーザー状態と設定を対象コンピューターに復元するため、状態移行ポイントへのアクセスを要求します。  

 複数の状態移行ポイントが存在する場合、このステップは、対象コンピューターに対する状態を持つ状態移行ポイントを検索します。  

 **再試行回数**  
 このステップが適切な状態移行ポイントを検索する試行回数です。この回数を超えるとステップは失敗します。  

 **再試行の待ち時間 (秒)**  
 タスク シーケンス ステップが再試行を行うまで待機する時間 (秒単位) です。  

 **コンピューター アカウントで状態ストアに接続できない場合、ネットワーク アクセス アカウントを使用する**  
 タスク シーケンスは、コンピューター アカウントを使って状態移行ポイントにアクセスできない場合、ネットワーク アクセス アカウントの資格情報を使って接続します。 他のコンピューターがネットワーク アクセス アカウントを使って格納されている状態にアクセスできるため、このオプションを使うと安全性が低下します。 対象コンピューターがドメインに参加していない場合、このオプションが必要になる可能性があります。  



##  <a name="BKMK_RestartComputer"></a> コンピューターの再起動  
 このステップでは、タスク シーケンスを実行しているコンピューターを再起動します。 コンピューターは再起動後、タスク シーケンスの次のステップから自動的に続行します。  

 このステップは、標準のオペレーティング システムでも、Windows PE でも実行できます。 このタスク シーケンス アクションのタスク シーケンス変数の詳細については、「[Restart Computer Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_RestartComputer)」 (コンピューターの再起動タスク シーケンス アクション変数) を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[コンピューターの再起動]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **このタスク シーケンスに割り当てられているブート イメージ**  
 タスク シーケンスに割り当てられているブート イメージを対象コンピューターで使うには、このオプションを選びます。 タスク シーケンスはブート イメージを使って、Windows PE で以降の手順を実行します。  

 **現在インストールされている既定のオペレーティング システム**  
 インストールされているオペレーティング システムで対象コンピューターを起動するには、このオプションを選択します。  

 **再起動する前にユーザーに通知する**  
 対象コンピューターを再起動する前にユーザーに通知を表示するには、このオプションを選びます。 このオプションは既定で有効になります。  

 **通知メッセージ**  
 対象コンピューターの再起動前にユーザーに表示する通知メッセージを入力します。  

 **メッセージ表示のタイムアウト**  
 対象コンピューターを再起動するまでの秒数を指定します。 既定値は 60 秒です。  



##  <a name="BKMK_RestoreUserState"></a> ユーザー状態の復元  
 このステップでは、ユーザー状態移行ツール (USMT) を開始して、対象コンピューターにユーザーの状態と設定を復元します。 このステップは、**[ユーザー状態のキャプチャ]** ステップと組み合わせて使います。  

 オペレーティング システムを展開するときに、ユーザー状態の移行を管理する方法の詳細については、「[Manage user state](../get-started/manage-user-state.md)」 (ユーザー状態の管理) を参照してください。  

 状態移行ポイントで状態の設定を保存または復元するには、このステップと共に **[状態ストアの要求]** および **[状態ストアのリリース]** ステップを使います。 USMT 3.0 以降では、このオプションにより Configuration Manager が生成および管理する暗号化キーを使った USMT 状態ストアの解読が必ず行われます。  

 **[ユーザー状態の復元]** ステップでは、最も一般的に使われるオプションの限定されたサブセットを制御できます。 その他のコマンド ライン オプションは、OSDMigrateAdditionalRestoreOptions タスク シーケンス変数で指定します。  

> [!IMPORTANT]  
>  オペレーティング システム展開シナリオとは関係のない目的にこのステップを使っている場合は、**[ユーザー状態の復元]** ステップの直後に [[コンピューターの再起動]](#BKMK_RestartComputer) ステップを追加します。  

 このステップは標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。 このタスク シーケンス アクションのタスク シーケンス変数については、「 [Restore User State Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_RestoreUserState)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[ユーザー状態]** を選んで、**[ユーザー状態の復元]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **ユーザー状態移行ツール パッケージ**  
 このステップで使うバージョンの USMT を含むパッケージを指定します。 このパッケージにはプログラムは必要ありません。 ステップ実行時に、タスク シーケンスは指定したパッケージに含まれる USMT のバージョンを使います。 32 ビット バージョンまたは 64 ビット バージョンの USMT を含むパッケージを指定します。 USMT のアーキテクチャは、タスク シーケンスが状態を復元するオペレーティング システムのアーキテクチャによって異なります。 

 **キャプチャしたすべてのユーザー プロファイルを標準オプションを使用して復元する**  
 キャプチャしたユーザー プロファイルを標準オプションを使用して復元します。 USMT が復元するオプションをカスタマイズするには、**[ユーザー プロファイルのキャプチャ方法をカスタマイズする]** を選びます。  

 **ユーザー プロファイルの復元方法をカスタマイズする**  
 対象のコンピューターに復元するファイルをカスタマイズできます。 **[ファイル]** をクリックして、ユーザー プロファイルの復元に使用する、USMT パッケージ内の構成ファイルを指定します。 構成ファイルを追加するには、**[ファイル名]** ボックスにファイル名を入力し、**[追加]** をクリックします。 [ファイル] ウィンドウには、USMT が使う構成ファイルが一覧表示されます。 USMT によって復元されるユーザー ファイルが定義されている .xml ファイルを指定します。  

 **ローカル コンピューターのユーザー プロファイルを復元する**  
 ローカル コンピューターのユーザー プロファイルを復元します。 これらのプロファイルは、ドメイン ユーザーのものではありません。 復元されるローカル ユーザー アカウントには、新しいパスワードを割り当てる必要があります。 USMT では元のパスワードを移行できません。 **[パスワード]** ボックスに新しいパスワードを入力し、**[パスワードの確認入力]** ボックスに確認のために同じパスワードを入力します。  

 **復元できないファイルがあっても続行する**  
 USMT が一部のファイルを復元できない場合でも、ユーザー状態と設定の復元を続行します。 このオプションは既定で有効になります。 このオプションを無効にした場合、ファイルの復元中に USMT でエラーが発生すると、このステップはすぐに失敗します。 USMT は、すべてのファイルを復元しません。   

 **詳細ログ記録を有効にする**  
 詳細なログ ファイル情報を生成するには、このオプションを有効にします。 状態を復元すると、タスク シーケンスは既定でタスク シーケンス ログ フォルダー \windows\system32\ccm\logs に Loadstate.log を生成します。  



##  <a name="BKMK_RunCommandLine"></a> コマンド ラインの実行  
 このステップでは、指定したコマンド ラインを実行します。  

 このステップは、標準のオペレーティング システムでも、Windows PE でも実行できます。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「 [Run Command Line Task Sequence Action Variables](task-sequence-action-variables.md#BKMK_RunCommand)」を参照してください。  

 タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[コマンド ラインの実行]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **コマンド ライン**  
 実行されたコマンド ラインを指定します。 このフィールドは必須です。 ベスト プラクティスとして、.vbs や .exe など、ファイル名拡張子を指定することをお勧めします。 必要な設定ファイル、コマンド ライン オプション、またはスイッチをすべて含めます。  

 ファイル名にファイル名拡張子が指定されていない場合は、Configuration Manager では .com、.exe、.bat が試されます。 ファイル名に拡張子が付いていても、それが実行可能ファイルでない場合は、Configuration Manager ではローカルの関連付けが適用されます。 たとえば、コマンド ラインが readme.gif の場合は、Configuration Manager では .gif ファイルを開くために対象のコンピューターで指定されたアプリケーションを起動します。  

 次に例を示します。  

 `setup.exe /a`  

 `cmd.exe /c copy Jan98.dat c:\sales\Jan98.dat`  

> [!NOTE]  
>  正常に実行するには、コマンド ライン アクションの前に **cmd.exe /c** コマンドを付加します。 このようなアクションの例は、出力のリダイレクト、パイプ処理、コピーなどのコマンドです。  

 **64 ビット ファイル システムのリダイレクトを無効にする**  
 64 ビット オペレーティング システムは、既定で WOW64 ファイル システム リダイレクターを使って、コマンド ラインを実行します。 この動作は、32 ビット バージョンのオペレーティング システムの実行可能ファイルとライブラリを正しくを検索するためです。 WOW64 ファイル システム リダイレクターの使用を無効にするには、このオプションを選びます。 Windows は、ネイティブの 64 ビット バージョンのオペレーティング システムの実行可能ファイルとライブラリを使って、コマンドを実行します。 32 ビット オペレーティング システムで実行している場合、このオプションによる影響はありません。  

 **開始**  
 プログラムの実行可能フォルダーを 127 文字以内で指定します。 このフォルダーには、対象のコンピューターの絶対パスを指定することも、パッケージを含む配布ポイント フォルダーを基準としたパスを指定することもできます。 このフィールドは省略可能です。  

 次に例を示します。  

 **c:\officexp**  

 **i386**  

> [!NOTE]  
>  **[参照]** ボタンは、ローカル コンピューターでファイルとフォルダーを参照します。 対象コンピューター上の同じ場所に同じファイル名およびフォルダー名で存在するものを、選ぶ必要があります。  

 **パッケージ**  
 対象のコンピューターにまだ存在しないファイルまたはプログラムをコマンド ラインで指定する場合、このオプションを選択して該当するファイルを含む Configuration Manager パッケージを指定します。 このパッケージにはプログラムは必要ありません。 このオプションは、指定するファイルが対象のコンピューターに存在する場合には必要ありません。  

 **タイムアウト**  
 Configuration Manager で、コマンド ラインに許容される実行時間を表す値を指定します。 可能な値は 1 ～ 999 分です。 既定値は 15 分です。  

 既定では、このオプションは無効になっています。  

> [!IMPORTANT]  
>  指定したコマンドが正常に完了するのに十分な余裕のない時間値を入力すると、このステップは失敗します。 他の制御の設定によっては、タスク シーケンス全体が失敗する可能性があります。 タイムアウトに達すると、Configuration Manager はコマンド ライン プロセスを終了します。  

 **このステップを次のアカウントで実行する**  
 ローカル システム アカウント以外の Windows ユーザー アカウントとして実行されるコマンド ラインを指定します。  

> [!NOTE]  
>  オペレーティング システムをインストールした後、別のアカウントで簡単なスクリプトまたはコマンドを実行するには、先にアカウントをコンピューターに追加しておく必要があります。 さらに、Windows インストーラーなどのより複雑なプログラムを実行するには、Windows ユーザー アカウント プロファイルを復元する必要があります。  

 **アカウント**  
 このステップでコマンド ラインを実行するために使う Windows ユーザー アカウントを指定します。 コマンド ラインは、指定されたアカウントのアクセス許可で実行します。 **[設定]** をクリックして、ローカル ユーザーまたはドメイン アカウントを指定します。  

> [!IMPORTANT]  
>  このステップでユーザー アカウントを指定し、Windows PE でステップを実行した場合、アクションは失敗します。 Windows PE をドメインに参加させることはできません。 このエラーは smsts.log ファイルに記録されます。  



##  <a name="BKMK_RunPowerShellScript"></a> PowerShell スクリプトの実行  
 このステップでは、指定した PowerShell スクリプトを実行します。  

 このステップは、標準のオペレーティング システムでも、Windows PE でも実行できます。 Windows PE でのこのステップを実行するには、ブート イメージで PowerShell を有効にする必要があります。 ブート イメージのプロパティの **[オプション コンポーネント]** タブで、Windows PowerShell (WinPE PowerShell) を有効にすることができます。 ブート イメージを変更する方法について詳しくは、「[Manage boot images](../get-started/manage-boot-images.md)」 (ブート イメージの管理) を参照してください。  

> [!NOTE]  
>  PowerShell は、Windows Embedded オペレーティング システムでは既定では無効です。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[PowerShell スクリプトの実行]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **パッケージ**  
 PowerShell スクリプトを含む Configuration Manager パッケージを指定します。 1 つのパッケージに複数の PowerShell スクリプトを含めることができます。  

 **スクリプト名**  
 実行する PowerShell スクリプトの名前を指定します。 このフィールドは必須です。  

 **パラメーター**  
 Windows PowerShell スクリプトに渡すパラメーターを指定します。 これらのパラメーターは、コマンド ラインでの Windows PowerShell スクリプトのパラメーターと同じです。  

> [!IMPORTANT]  
>  Windows PowerShell のコマンド ラインで使用するパラメーターではなく、スクリプトで使用するパラメーターを指定します。  
>   
>  次の例には、有効なパラメーターが含まれています。  
>   
>  `-MyParameter1 MyValue1 -MyParameter2 MyValue2`  
>   
>  次の例には、無効なパラメーターが含まれています。 最初の 2 つの項目は、Windows PowerShell のコマンド ライン パラメーターです (**-NoLogo** と **-ExecutionPolicy Unrestricted**)。 スクリプトはこれらのパラメーターを使いません。  
>   
>  `-NoLogo -ExecutionPolicy Unrestricted -File MyScript.ps1 -MyParameter1 MyValue1 -MyParameter2 MyValue2`  

 **PowerShell 実行ポリシー**  
 コンピューターでの実行を許可する Windows PowerShell スクリプト (ある場合) を決定します。 次のいずれかの実行ポリシーを選択します。  

-   **AllSigned**: 信頼できる発行元によって署名されたスクリプトのみを実行します  

-   **Undefined**: 実行ポリシーを何も定義しません  

-   **Bypass**: すべての構成ファイルを読み込み、すべてのスクリプトを実行します。 未署名のスクリプトをインターネットからダウンロードする場合、Windows PowerShell はスクリプトを実行する前にアクセス許可を要求するメッセージを表示しません。  

> [!IMPORTANT]  
>  PowerShell 1.0 は [未定義] および [バイパス] の実行ポリシーをサポートしていません。  



##  <a name="child-task-sequence"></a> タスク シーケンスの実行

Configuration Manager バージョン 1710 以降では、別のタスク シーケンスを実行する新しいステップを追加できます。 このステップでは、タスク シーケンス間の親子関係を作成します。 子タスク シーケンスを使うと、よりモジュール性の高い、再利用可能なタスク シーケンスを作成できます。

タスク シーケンスに子タスク シーケンスを追加する場合は、以下の点を考慮してください。
 - 親と子のタスク シーケンスが、クライアントが実行する 1 つのポリシーに効率的に結合されていること。
 - 環境がグローバルであること。 親タスク シーケンスが変数を設定し、子タスク シーケンスがその変数を変更し場合は、最新の値が保持されます。 子タスク シーケンスが新しい変数を作成した場合、それ以降の親タスク シーケンスはその変数を使うことができます。
 - ステータス メッセージは、通常どおり 1 つのタスク シーケンス操作で複数送信されること。
 - タスク シーケンスは、エントリを smsts.log ファイルに書き込み、新しいログ エントリによって子タスク シーケンスの開始タイミングを明確にするということ。

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[タスク シーケンスの実行]** を選びます。 

### <a name="properties"></a>プロパティ
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

**実行するタスク シーケンスの選択**  
 **[参照]** をクリックして子タスク シーケンスを選択します。 **[タスク シーケンスの選択]** ダイアログ ボックスでは、親タスク シーケンスは表示されません。



##  <a name="BKMK_SetDynamicVariables"></a> 動的変数の設定  
 このステップでは、次のアクションを実行します。  

1.  コンピューターとその環境から情報を収集し、指定したタスク シーケンス変数に情報を設定します。  

2.  定義されている規則を評価し、true と評価される規則に構成されている変数と値に基づいてタスク シーケンス変数を設定します。  

タスク シーケンスによって、次の読み取り専用のタスク シーケンス変数が自動的に設定されます。  
 -   &#95;SMSTSMake  
 -   &#95;SMSTSModel  
 -   &#95;SMSTSMacAddresses  
 -   &#95;SMSTSIPAddresses  
 -   &#95;SMSTSSerialNumber  
 -   &#95;SMSTSAssetTag  
 -   &#95;SMSTSUUID  

このステップは、標準のオペレーティング システムでも、Windows PE でも実行できます。 タスク シーケンス変数の詳細については、「[Task sequence action variables](task-sequence-action-variables.md)」 (タスク シーケンス アクション変数) を参照してください。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[動的変数の設定]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

**動的規則と変数**  
 タスク シーケンスで使うための動的変数を設定するには、規則を追加します。 その後、規則で指定されている各変数に値を設定します。 さらに、規則を追加せずに、1 つまたは複数の変数を追加します。 規則を追加するときは、次のカテゴリから選びます。  

 -   **コンピューター**: ハードウェア資産タグ、UUID、シリアル番号、または MAC アドレスの値を評価します。 必要に応じて、複数の値を設定します。 いずれかの値が true の場合、その規則は true と評価されます。 たとえば、デバイスのシリアル番号が 5892087 で MAC アドレスが 22-A4-5A-13-78-26 の場合、次の規則は true と評価されます。  

     `IF Serial Number = 5892087 OR MAC address = 26-78-13-5A-A4-22 THEN`  

-   **場所**: 既定のネットワーク ゲートウェイの値を評価します  

-   **メーカーおよびモデル**: コンピューターの製造元およびモデルの値を評価します。 規則を true と評価するには、製造元とモデルの両方が true と評価される必要があります。   

    <!-- for future edits: an escape code must be used for the bolded asterisk character, but may be removed somewhere along the way. Instead of five asterisk, should be bold tags with &#42; in-between -->

    Configuration Manager バージョン 1610 以降では、ワイルドカードとしてアスタリスク (**&#42;**) と疑問符 (**?**) を指定できます。**&#42;** は複数の文字と一致し、**?** は 1 文字と一致します。 たとえば、"DELL*900?" という文字列は、 DELL-ABC-9001 や DELL9009 と一致します。 

    ワイルドカードとしてアスタリスク (**&#42;**) と疑問符 (**?**) を指定します。**&#42;** は複数の文字と一致し、**?** は 1 文字と一致します。 たとえば、"DELL*900?" という文字列は、 DELL-ABC-9001 や DELL9009 と一致します。

-   **タスク シーケンス変数**: 評価するタスク シーケンス変数、条件、および値を追加します。 変数に設定された値が指定した条件を満たしている場合、規則は true と評価されます。  

    true と評価される規則に対して設定する 1 つ以上の変数を指定するか、規則を使わずに変数を設定します。 既存の変数を選ぶか、カスタム変数を作成します。  

     -   **既存のタスク シーケンス変数**: 既存のタスク シーケンス変数の一覧から 1 つ以上の変数を選びます。 配列変数は選択できません。  

     -   **カスタム タスク シーケンス変数**: カスタム タスク シーケンス変数を定義します。 既存のタスク シーケンス変数を指定することもできます。 この設定は、変数の配列は既存のタスク シーケンス変数の一覧に含まれないため、OSDAdapter などの既存の変数配列を指定する場合に便利です。  

規則に変数を選択した後、各変数の値を指定する必要があります。 規則が true と評価されると、変数は指定された値に設定されます。 変数ごとに **[秘密の値]** を選択して変数の値を非表示にできます。 既定では、OSDCaptureAccountPassword タスク シーケンス変数など、いくつかの既存の変数の値を非表示にします。  

> [!IMPORTANT]  
>  Configuration Manager は、**動的変数の設定**ステップでタスク シーケンスをインポートするとき、**シークレット値**としてマークされているすべての変数値を削除します。 タスク シーケンスをインポートした後で、動的変数の値を再入力します。  



##  <a name="BKMK_SetTaskSequenceVariable"></a> タスク シーケンス変数の設定  
このステップでは、タスク シーケンスで使われる変数の値を設定します。  

このステップは、標準のオペレーティング システムでも、Windows PE でも実行できます。 タスク シーケンス変数はタスク シーケンス アクションによって読み取られます。また、これらのアクションの動作はタスク シーケンス変数によって指定されます。 特定のタスク シーケンス アクション変数の詳細については、「[タスク シーケンス アクション変数](task-sequence-action-variables.md)」を参照してください。 特定のタスク シーケンス組み込み変数の詳細については、「[タスク シーケンス組み込み変数](/sccm/osd/understand/task-sequence-built-in-variables)」を参照してください。

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[全般]** を選んで、**[タスク シーケンス変数の設定]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **タスク シーケンス変数**  
 タスク シーケンスの組み込み変数またはアクション変数の名前を指定するか、独自のユーザー定義変数の名前を指定します。  

 **値**  
 タスク シーケンスは、変数をこの値に設定します。 このタスク シーケンス変数を別のタスク シーケンス変数の値に設定するには、%varname% という構文を使います。  



##  <a name="BKMK_SetupWindowsandConfigMgr"></a> Windows と ConfigMgr のセットアップ  
 このステップでは、Windows PE から新しいオペレーティング システムへの移行を実行します。 このタスク シーケンス ステップはあらゆるオペレーティング システム展開に必要です。 このステップでは、Configuration Manager クライアントを新しいオペレーティング システムにインストールして、新しいオペレーティング システムでタスク シーケンスの実行を継続できるようにします。  

 このステップは Windows PE でのみ実行されます。 このステップは標準のオペレーティング システムでは実行できません。 このタスク シーケンス アクション用のタスク シーケンス変数の詳細については、「[Windows と ConfigMgr のセットアップ タスク シーケンス アクション変数](task-sequence-action-variables.md#BKMK_SetupWindows)」を参照してください。  

 このステップでは、sysprep.inf または unattend.xml のディレクトリ変数 (%WINDIR% や %ProgramFiles% など) が、Windows PE のインストール ディレクトリ X:\Windows に置き換えられます。 タスク シーケンスは、これらの環境変数を使って指定されている変数を無視します。  

 このタスク シーケンス ステップを使用して次のアクションを実行します。  

1.  準備: Windows PE  

    1.  unattend.xml ファイルのタスク シーケンス変数を置換します。  

    2.  Configuration Manager クライアントを含むパッケージをダウンロードします。 展開されるイメージにパッケージを追加します。  

2.  Windows の設定  

    1.  イメージ ベースのインストール  

        1.  イメージで Configuration Manager クライアントを無効にします (存在する場合)。 つまり、Configuration Manager クライアント サービスの自動開始を無効にします。  

        2.  展開されるイメージのレジストリを更新して、展開されるオペレーティング システムが、参照コンピューターと同じドライブ文字で起動されるようにします。  

        3.  展開されたオペレーティング システムを再起動します。  

        4.  前に指定した sysprep.inf または unattend.xml 応答ファイルを使って、Windows ミニセットアップが実行されます。このとき、エンド ユーザーの操作はすべて抑制されます。 **[ネットワーク設定の適用]** ステップを使ってドメインに参加する場合、その情報は応答ファイル内にあります。 Windows ミニセットアップがドメインにコンピューターを参加させます。  

    2.  Setup.exe ベースのインストール。  通常の Windows セットアップ プロセスに続く Setup.exe を実行します。  

        1.  **[オペレーティング システムの適用]** ステップで指定されている OS アップグレード パッケージを、ハード ディスク ドライブにコピーします。  

        2.  新しく展開されたオペレーティング システムで再起動します。  

        3.  前に指定した sysprep.inf または unattend.xml 応答ファイルを使って、Windows ミニセットアップが実行されます。このとき、ユーザーのインターフェイス設定はすべて抑制されます。 **[ネットワーク設定の適用]** ステップを使ってドメインに参加する場合、その情報は応答ファイル内にあります。 Windows ミニセットアップがドメインにコンピューターを参加させます。  

3.  Configuration Manager クライアントの設定  

    1.  Windows ミニセットアップが完了すると、setupcomplete.cmd を使用して、タスク シーケンスが再開されます。  

    2.  **[Windows 設定の適用]** ステップで選んだオプションに応じて、ローカルの管理者アカウントが有効または無効になります。  

    3.  前にダウンロードしたパッケージとこのステップで指定したインストール プロパティを使って、Configuration Manager クライアントがインストールされます。 タスク シーケンスが完了するまでクライアントが新しいポリシー要求を処理しないよう、クライアントは "プロビジョニング モード" でインストールされます。  

    4.  クライアントが完全に動作可能な状態になるまで待ちます。  

4.  タスク シーケンスは次のステップの実行を続けます。  

<!-- Engineering confirmed that the task sequence does nothing with respect to group policy processing.
> [!NOTE]  
>  The **Setup Windows and ConfigMgr** task sequence action is responsible for running Group Policy on the newly installed computer. The Group Policy is applied after the task sequence is finished.  
-->

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[Windows と ConfigMgr のセットアップ]** を選びます。 

### <a name="properties"></a>プロパティ  
 このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

 **クライアント パッケージ**  
 **[参照]** をクリックし、このステップで使う Configuration Manager クライアント インストール パッケージを選びます。  

 **使用可能な場合に実稼働前クライアント パッケージを使用する**  
 使用可能な実稼働前クライアント パッケージがあり、コンピューターがパイロット コレクションのメンバーである場合、タスク シーケンスは実稼働クライアント パッケージではなく、このパッケージを使います。 実稼働前クライアントは、実稼働環境でのテスト用の新しいバージョンです。 **[参照]** をクリックし、このステップで使う実稼働前クライアント インストール パッケージを選びます。  

 **インストールのプロパティ**  
 サイトの割り当てと既定の構成は、タスク シーケンス アクションによって自動的に指定されます。 このフィールドは、クライアントのインストール時に使用する追加のインストールのプロパティを指定するために使用できます。 複数のインストールのプロパティを入力するには、各プロパティの間にスペースを入力します。  

 クライアントのインストール時に使用するコマンド ライン オプションを指定できます。 たとえば、「 **/skipprereq: silverlight.exe** 」と入力すると、CCMSetup.exe に Microsoft Silverlight 前提条件をインストールしないように通知できます。 CCMSetup.exe の使用可能なコマンド ライン オプションの詳細については、「[クライアント インストールのプロパティについて](../../core/clients/deploy/about-client-installation-properties.md)」を参照してください。  

### <a name="options"></a>Options
> [!NOTE]
> **[オプション]** タブで **[エラー時に続行する]** を有効にしないでください。このステップの間にエラーが発生した場合は、この設定が有効かどうかにかかわらず、タスク シーケンスは失敗します。



##  <a name="BKMK_UpgradeOS"></a> オペレーティング システムのアップグレード  
 > [!TIP]  
 > Windows 10 バージョン 1709 以降では、メディアに複数のエディションが含まれます。 タスク シーケンスが OS アップグレード パッケージまたは OS イメージを使うように構成するときは、[サポートされているエディション](/sccm/core/plan-design/configs/support-for-windows-10#windows-10-as-a-client)を必ず選んでください。

 このステップでは、古いバージョンの Windows を新しいバージョンの Windows 10 にアップグレードします。  

 このタスク シーケンス ステップは、標準のオペレーティング システムでのみ実行できます。 Windows PE では実行できません。  

タスク シーケンス エディターでこのステップを追加するには、**[追加]** をクリックし、**[イメージ]** を選んで、**[オペレーティング システムのアップグレード]** を選びます。 

### <a name="properties"></a>プロパティ  
このステップの **[プロパティ]** タブでは、このセクションで説明する設定を構成します。  

**パッケージのアップグレード**  
 アップグレードに使用する Windows 10 オペレーティング システム アップグレード パッケージを指定するには、このオプションを選択します。  

**ソース パス**  
 Windows セットアップが使う Windows 10 メディアへのローカル パスまたはネットワーク パスを指定します。 この設定は、Windows セットアップのコマンド ライン オプション **/InstallFrom** に対応します。 %mycontentpath%、%DPC01% などの変数を指定することもできます。 ソース パスに変数を使用する場合は、その変数をタスク シーケンスで先に指定しておく必要があります。 たとえば、タスク シーケンスで [パッケージ コンテンツのダウンロード](#BKMK_DownloadPackageContent) ステップを使用する場合は、オペレーティング システム アップグレード パッケージの場所に変数を指定できます。 その後、このステップのソース パスに変数を使用できます。  

**エディション**  
 アップグレードに使用するオペレーティング システム メディア内のエディションを指定します。  

**プロダクト キー**  
 アップグレード プロセスに適用するプロダクト キーを指定します。  

**アップグレードの際に、Windows セットアップに次のドライバー コンテンツを指定してください**  
 アップグレード プロセスの間に、対象コンピューターにドライバーを追加します。 この設定は、Windows セットアップのコマンド ライン オプション **/InstallDriver** に対応します。 ドライバーは、Windows 10 と互換性がある必要があります。 次のいずれかのオプションを指定します。  

-   **ドライバー パッケージ**: **[参照]** をクリックし、一覧から既存のドライバー パッケージを選択します。  

-   **ステージング済みコンテンツ**: ドライバー パッケージの場所を指定するには、このオプションを選択します。 ローカル フォルダー、ネットワーク パス、またはタスク シーケンス変数を指定できます。 ソース パスに変数を使用する場合は、その変数をタスク シーケンスで先に指定しておく必要があります。 たとえば、 [Download Package Content](task-sequence-steps.md#BKMK_DownloadPackageContent) ステップを使用します。  

**タイムアウト (分)**  
 Configuration Manager がこのステップを失敗とするまでの分数を指定します。 このオプションは、Windows セットアップが処理を停止しても終了はしない場合に便利です。  

**アップグレードを開始しない Windows セットアップ互換性スキャンの実行**  
 アップグレード プロセスを開始せずに、Windows セットアップの互換性スキャンを実行します。 この設定は、Windows セットアップのコマンド ライン オプション **/Compat ScanOnly** に対応します。 このオプションを使う場合は、インストール ソース全体を展開する必要があります。 セットアップでは、スキャンの結果として終了コードが返されます。 次の表に一般的な終了コードをいくつか示します。  

|終了コード|詳細|  
|-|-|  
|MOSETUP_E_COMPAT_SCANONLY (0xC1900210)|互換性の問題なし ("成功")。|  
|MOSETUP_E_COMPAT_INSTALLREQ_BLOCK (0xC1900208)|対応可能な互換性の問題。|  
|MOSETUP_E_COMPAT_MIGCHOICE_BLOCK (0xC1900204)|選択された移行オプションが使用できない。 Enterprise から Professional へのアップグレードなど。|  
|MOSETUP_E_COMPAT_SYSREQ_BLOCK (0xC1900200)|Windows 10 に適合しない。|  
|MOSETUP_E_COMPAT_INSTALLDISKSPACE_BLOCK (0xC190020E)|ディスクの空き領域が不足している。|  

このパラメーターの詳細については、「 [Windows セットアップ コマンド ライン オプション](https://msdn.microsoft.com/library/windows/hardware/dn938368\(v=vs.85\).aspx)」を参照してください。  

**互換性に関するメッセージが無視できる場合、すべて無視する**  
 無視できる互換性に関するメッセージをすべて無視して、セットアップがインストールを完了するように指定します。 この設定は、Windows セットアップのコマンド ライン オプション **/Compat IgnoreWarning** に対応します。  

**Windows Update で Windows セットアップを動的に更新する**  
 検索、ダウンロード、更新プログラムのインストールなどの動的な更新操作をセットアップが実行できるようにします。 この設定は、Windows セットアップのコマンド ライン オプション **/DynamicUpdate** に対応します。 この設定は、Configuration Manager のソフトウェア更新プログラムと互換性がありません。 スタンドアロンの Windows Server Update Services (WSUS) または Windows Update for Business で更新プログラムを管理する場合は、このオプションを有効にします。  

**ポリシーを上書きして既定の Microsoft Update を使う**: リアルタイムでローカル ポリシーを一時的に無効にして動的な更新操作を実行し、コンピューターに Windows Update から更新プログラムを取得します。
