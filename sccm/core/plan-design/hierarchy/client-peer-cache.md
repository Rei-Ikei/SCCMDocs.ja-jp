---
title: クライアントのピア キャッシュ
titleSuffix: Configuration Manager
description: System Center Configuration Manager でコンテンツを展開する場合は、クライアントのコンテンツ ソースの場所のピア キャッシュを使用します。
ms.custom: na
ms.date: 04/10/2018
ms.reviewer: na
ms.suite: na
ms.prod: configuration-manager
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 86cd5382-8b41-45db-a4f0-16265ae22657
caps.latest.revision: 3
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 99eef9faf6ac66f65d16020b703e3a64d9beb9d0
ms.sourcegitcommit: fb84bcb31d825f454785e3d9d8be669e00fe2b27
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/16/2018
---
# <a name="peer-cache-for-configuration-manager-clients"></a>Configuration Manager クライアントのピア キャッシュ

*適用対象: System Center Configuration Manager (Current Branch)*

<!--1101436-->
**ピア キャッシュ**は、リモートの場所にあるクライアントへのコンテンツの展開を管理するのに役立ちます。 ピア キャッシュとは、クライアントがローカル キャッシュで他のクライアントとコンテンツを直接共有できるようにするための組み込みの Configuration Manager ソリューションです。   

> [!TIP]  
> この機能はバージョン 1610 で[プレリリース機能](/sccm/core/servers/manage/pre-release-features)として初めて導入されました。 1710 以降のバージョンでは、この機能はプレリリース機能ではありません。  


> [!Note]  
> Configuration Manager では、このオプション機能は既定で無効です。 この機能は、使用する前に有効にする必要があります。 詳細については、「[更新プログラムのオプション機能の有効化](/sccm/core/servers/manage/install-in-console-updates#bkmk_options)」を参照してください。<!--505213-->  


## <a name="overview"></a>概要
ピア キャッシュ クライアントは、ピア キャッシュの使用が有効にされた構成マネージャー クライアントです。 追加のクライアントと共有できるコンテンツを含むピア キャッシュ クライアントは、ピア キャッシュ ソースです。
 -  クライアント設定を使用してピア キャッシュを使用するクライアントを有効にできます。
 -  ピア キャッシュ ソースとしてコンテンツを共有するには、ピア キャッシュ クライアントは以下である必要があります。
    -  ドメインに参加している必要があります。 ただし、ドメインに参加していないコンテンツは、ドメインに参加しているピア キャッシュ ソースからコンテンツを取得できます。
    -  コンテンツをシークしている、クライアントの現在の境界グループのメンバーである必要があります。 クライアントがフォールバックを使用して近隣の境界グループからコンテンツをシークする場合は、近隣の境界グループのピア クライアントはコンテンツ ソースの場所の一覧に含まれません。 現在および近隣の境界グループの詳細については、「[境界グループ](/sccm/core/servers/deploy/configure/define-site-boundaries-and-boundary-groups##a-namebkmkboundarygroupsa-boundary-groups)」を参照してください。
 - Configuration Manager クライアントは、キャッシュ内のすべての種類のコンテンツを、ピア キャッシュを使用して他のクライアントに提供できます。 このコンテンツは、Office 365 ファイルを含み、インストール ファイルを表します。<!--SMS.500850-->
 -  ピア キャッシュは、BranchCache のようなその他のソリューションに代わるものではありません。 ピア キャッシュを他のソリューションと組み合わせて使用することで、配布ポイントなどの従来のコンテンツ展開ソリューションを拡張するためのオプションを増やすことができます。 ピア キャッシュは、BranchCache に依存しないカスタム ソリューションです。 Windows BranchCache を有効にしていない場合または使用していない場合でも、ピア キャッシュは正常に動作します。

### <a name="operations"></a>オペレーション

ピア キャッシュを有効にするには、クライアント設定をコレクションに展開します。 すると、そのコレクションのメンバーは、同じ境界グループ内の他のクライアント用のピア コンテンツ ソースとして機能します。
 -  ピア コンテンツ ソースとして動作するクライアントは、キャッシュされている利用可能なコンテンツの一覧を管理ポイントに送信します。
 -  その境界グループ内の次のクライアントがそのコンテンツを要求すると、該当するコンテンツを含みオンラインになっている各ピア キャッシュ ソースが利用可能なコンテンツ ソースの一覧に返されます。 この一覧には、その境界グループにおける配布ポイントやその他のコンテンツ ソースの場所も含まれます。
 -  標準プロセスごとに、コンテンツをシークしているクライアントは、指定されたリストから 1 つのソースを選択します。 次にクライアントは、コンテンツの取得を試みます。

> [!NOTE]
> コンテンツの近隣の境界グループへのフォールバックがクライアントによって行われる場合、近隣の境界グループからのピア キャッシュ コンテンツ ソースの場所は、潜在的なコンテンツ ソースの場所の一覧に追加されません。  


ピア キャッシュ ソースとして最適なクライアントのみを選択することをお勧めします。 シャーシの種類、ディスク容量、ネットワーク接続などの属性に基づいてクライアントの適合性を評価します。 ピア キャッシュで使用する最適なクライアントを選択するのに役立つ詳細については、[Microsoft のコンサルタントによる、このブログ](https://blogs.technet.microsoft.com/setprice/2016/06/29/pe-peer-cache-custom-reporting-examples/)を参照してください。

**ピア キャッシュ ソースへのアクセス制限**  
バージョン 1702 以降、ピア キャッシュ ソース コンピューターが次のいずれかの条件を満たす場合、ピア キャッシュ ソース コンピューターはコンテンツの要求を拒否します。  
  -  バッテリ低下モードの場合。
  -  コンテンツの要求時に CPU 負荷が 80% を超えている場合。
  -  ディスク I/O の *AvgDiskQueueLength* が 10 を超えている場合。
  -  新たにコンピューターに接続できない場合。   

これらの設定は、Configuration Manager SDK のピア ソース機能 (*SMS_WinPEPeerCacheConfig*) のクライアント構成サーバー WMI クラスを使って構成します。

コンピューターがコンテンツの要求を拒否すると、要求元のコンピューターは、利用可能なコンテンツ ソースの場所の一覧でコンテンツを引き続きシークします。   



### <a name="monitoring"></a>監視   
クライアントが正常にピア キャッシュの使用を把握しやすいように、クライアント データ ソース ダッシュボードを表示できます。 「[Client Data Sources dashboard](/sccm/core/servers/deploy/configure/monitor-content-you-have-distributed#client-data-sources-dashboard)」 (クライアント データ ソースのダッシュボード) を参照してください。

バージョン 1702 以降では、3 つのレポートを使ってピア キャッシュの使用状況を表示できます。 コンソールで、**[監視]** > **[レポート]** > **[レポート]** に移動します。 すべてのレポートの種類は**ソフトウェア配布コンテンツ**です。
1.  **ピア キャッシュ ソース コンテンツの拒否**:  
境界グループ内のピア キャッシュ ソースがコンテンツ要求を拒否した頻度を把握するには、このレポートを使います。
 - **既知の問題:** *MaxCPULoad* や *MaxDiskIO* などの結果にドリルダウンすると、レポートまたは詳細情報が見つからないことを示すエラーが発生する場合があります。 この問題を回避するには、結果を直接表示する次の 2 つのレポートを使ってください。

2. **条件別のピア キャッシュ ソース コンテンツの拒否**:  
指定した境界グループまたは拒否の種類についての拒否の詳細を把握するには、このレポートを使います。 以下を指定できます

  - **既知の問題:** 使用可能なパラメーターから選ぶことができず、代わりに手入力する必要があります。 最初のレポートに表示される*境界グループ名*と*拒否の種類*の値を入力します。 たとえば、*拒否の種類*には、*MaxCPULoad* や *MaxDiskIO* などと入力します。

3. **ピア キャッシュ ソース コンテンツの拒否の詳細**:   
  拒否されたときにクライアントが要求していたコンテンツを把握するには、このレポートを使います。

 - **既知の問題:** 使用可能なパラメーターから選ぶことができず、代わりに手入力する必要があります。 **[ピア キャッシュ ソース コンテンツの拒否]** レポートに表示されている "*拒否の種類*" の値を入力します。 詳細情報を確認するコンテンツ ソースの "*リソース ID*" を入力します。 コンテンツ ソースのリソース ID を調べるには:  

    1. **[ピア キャッシュ ソース コンテンツの拒否 (条件別)]** レポートの結果に "*ピア キャッシュ ソース*" として表示されるコンピューター名を確認します。  
    2. 次に、**[資産とコンプライアンス]** > **[デバイス]** に移動し、そのコンピューター名を検索します。 [リソース ID] 列の値を使います。  


## <a name="requirements-and-considerations-for-peer-cache"></a>ピア キャッシュの要件と考慮事項
-   ピア キャッシュは、Configuration Manager クライアントとしてサポートされているすべての Windows OS でサポートされています。 Windows 以外のオペレーティング システムは、ピア キャッシュではサポートされていません。

-   クライアントは、現在の境界グループ内にあるピア キャッシュ クライアントのコンテンツのみを転送できます。

-   バージョン 1706 以前の場合、クライアントがピア キャッシュを使用する各サイトは、[ネットワーク アクセス アカウント](/sccm/core/plan-design/hierarchy/manage-accounts-to-access-content#a-namebkmknaaa-network-access-account)を使用して構成する必要があります。 バージョン 1706 以降、1 つの例外を除き、そのアカウントは不要になりました。 その例外シナリオとは、ピア キャッシュ対応のクライアントがソフトウェア センターからタスク シーケンスを実行し、そのタスク シーケンスがブート イメージを再起動する場合です。 このシナリオでは、クライアントは引き続きネットワーク アクセス アカウントを必要とします。 クライアントが Windows PE で動作している場合、クライアントはネットワーク アクセス アカウントを使用してピア キャッシュ ソースからコンテンツを取得します。

    必要に応じて、ピア キャッシュ ソース コンピューターはピアからのダウンロード要求を認証するためにネットワーク アクセス アカウントを使用します。 このような目的でこのアカウントを使用する場合はドメイン ユーザーのアクセス許可のみが必要です。

-   クライアントの最後のハードウェア インベントリ送信により、ピア キャッシュ コンテンツ ソースの現在の境界が決定します。 異なる境界グループにローミングしたクライアントは、ピア キャッシュの目的で、引き続き以前の境界グループのメンバーである場合があります。 この動作により、直接のネットワークの場所にないピア キャッシュ コンテンツ ソースがクライアントに提供されます。 この構成の傾向のあるクライアントをピア キャッシュ ソースとして参加させないようにすることをお勧めします。
-    バージョン 1706 以降、ピア キャッシュ クライアントは、ピア キャッシュ コンテンツ ソースがオンラインになっていることを検証してからコンテンツのダウンロードを試みます。 <!--sms.498675-->

## <a name="to-configure-client-peer-cache-client-settings"></a>クライアント ピア キャッシュのクライアント設定を構成するには
クライアント設定の構成については、「[クライアント キャッシュ設定](/sccm/core/clients/deploy/about-client-settings#client-cache-settings)」を参照してください。 詳しくは、「[クライアント設定を構成する方法](/sccm/core/clients/deploy/configure-client-settings)」をご覧ください。

Windows ファイアウォールを使用するピア キャッシュ対応のクライアント上では、Configuration Manager が、クライアント設定で指定されたファイアウォール ポートを構成します。
